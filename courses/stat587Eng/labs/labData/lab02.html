<!DOCTYPE html>
<!-- saved from url=(0014)about:internet -->
<html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8"/>
<meta http-equiv="x-ua-compatible" content="IE=9" >

<title>Getting started</title>

<style type="text/css">
body, td {
   font-family: sans-serif;
   background-color: white;
   font-size: 12px;
   margin: 8px;
}

tt, code, pre {
   font-family: 'DejaVu Sans Mono', 'Droid Sans Mono', 'Lucida Console', Consolas, Monaco, monospace;
}

h1 { 
   font-size:2.2em; 
}

h2 { 
   font-size:1.8em; 
}

h3 { 
   font-size:1.4em; 
}

h4 { 
   font-size:1.0em; 
}

h5 { 
   font-size:0.9em; 
}

h6 { 
   font-size:0.8em; 
}

a:visited {
   color: rgb(50%, 0%, 50%);
}

pre {	
   margin-top: 0;
   max-width: 95%;
   border: 1px solid #ccc;
   white-space: pre-wrap;
}

pre code {
   display: block; padding: 0.5em;
}

code.r, code.cpp {
   background-color: #F8F8F8;
}

table, td, th {
  border: none;
}

blockquote {
   color:#666666;
   margin:0;
   padding-left: 1em;
   border-left: 0.5em #EEE solid;
}

hr {
   height: 0px;
   border-bottom: none;
   border-top-width: thin;
   border-top-style: dotted;
   border-top-color: #999999;
}

@media print {
   * { 
      background: transparent !important; 
      color: black !important; 
      filter:none !important; 
      -ms-filter: none !important; 
   }

   body { 
      font-size:12pt; 
      max-width:100%; 
   }
       
   a, a:visited { 
      text-decoration: underline; 
   }

   hr { 
      visibility: hidden;
      page-break-before: always;
   }

   pre, blockquote { 
      padding-right: 1em; 
      page-break-inside: avoid; 
   }

   tr, img { 
      page-break-inside: avoid; 
   }

   img { 
      max-width: 100% !important; 
   }

   @page :left { 
      margin: 15mm 20mm 15mm 10mm; 
   }
     
   @page :right { 
      margin: 15mm 10mm 15mm 20mm; 
   }

   p, h2, h3 { 
      orphans: 3; widows: 3; 
   }

   h2, h3 { 
      page-break-after: avoid; 
   }
}

</style>

<!-- Styles for R syntax highlighter -->
<style type="text/css">
   pre .operator,
   pre .paren {
     color: rgb(104, 118, 135)
   }

   pre .literal {
     color: rgb(88, 72, 246)
   }

   pre .number {
     color: rgb(0, 0, 205);
   }

   pre .comment {
     color: rgb(76, 136, 107);
   }

   pre .keyword {
     color: rgb(0, 0, 255);
   }

   pre .identifier {
     color: rgb(0, 0, 0);
   }

   pre .string {
     color: rgb(3, 106, 7);
   }
</style>

<!-- R syntax highlighter -->
<script type="text/javascript">
var hljs=new function(){function m(p){return p.replace(/&/gm,"&amp;").replace(/</gm,"&lt;")}function f(r,q,p){return RegExp(q,"m"+(r.cI?"i":"")+(p?"g":""))}function b(r){for(var p=0;p<r.childNodes.length;p++){var q=r.childNodes[p];if(q.nodeName=="CODE"){return q}if(!(q.nodeType==3&&q.nodeValue.match(/\s+/))){break}}}function h(t,s){var p="";for(var r=0;r<t.childNodes.length;r++){if(t.childNodes[r].nodeType==3){var q=t.childNodes[r].nodeValue;if(s){q=q.replace(/\n/g,"")}p+=q}else{if(t.childNodes[r].nodeName=="BR"){p+="\n"}else{p+=h(t.childNodes[r])}}}if(/MSIE [678]/.test(navigator.userAgent)){p=p.replace(/\r/g,"\n")}return p}function a(s){var r=s.className.split(/\s+/);r=r.concat(s.parentNode.className.split(/\s+/));for(var q=0;q<r.length;q++){var p=r[q].replace(/^language-/,"");if(e[p]){return p}}}function c(q){var p=[];(function(s,t){for(var r=0;r<s.childNodes.length;r++){if(s.childNodes[r].nodeType==3){t+=s.childNodes[r].nodeValue.length}else{if(s.childNodes[r].nodeName=="BR"){t+=1}else{if(s.childNodes[r].nodeType==1){p.push({event:"start",offset:t,node:s.childNodes[r]});t=arguments.callee(s.childNodes[r],t);p.push({event:"stop",offset:t,node:s.childNodes[r]})}}}}return t})(q,0);return p}function k(y,w,x){var q=0;var z="";var s=[];function u(){if(y.length&&w.length){if(y[0].offset!=w[0].offset){return(y[0].offset<w[0].offset)?y:w}else{return w[0].event=="start"?y:w}}else{return y.length?y:w}}function t(D){var A="<"+D.nodeName.toLowerCase();for(var B=0;B<D.attributes.length;B++){var C=D.attributes[B];A+=" "+C.nodeName.toLowerCase();if(C.value!==undefined&&C.value!==false&&C.value!==null){A+='="'+m(C.value)+'"'}}return A+">"}while(y.length||w.length){var v=u().splice(0,1)[0];z+=m(x.substr(q,v.offset-q));q=v.offset;if(v.event=="start"){z+=t(v.node);s.push(v.node)}else{if(v.event=="stop"){var p,r=s.length;do{r--;p=s[r];z+=("</"+p.nodeName.toLowerCase()+">")}while(p!=v.node);s.splice(r,1);while(r<s.length){z+=t(s[r]);r++}}}}return z+m(x.substr(q))}function j(){function q(x,y,v){if(x.compiled){return}var u;var s=[];if(x.k){x.lR=f(y,x.l||hljs.IR,true);for(var w in x.k){if(!x.k.hasOwnProperty(w)){continue}if(x.k[w] instanceof Object){u=x.k[w]}else{u=x.k;w="keyword"}for(var r in u){if(!u.hasOwnProperty(r)){continue}x.k[r]=[w,u[r]];s.push(r)}}}if(!v){if(x.bWK){x.b="\\b("+s.join("|")+")\\s"}x.bR=f(y,x.b?x.b:"\\B|\\b");if(!x.e&&!x.eW){x.e="\\B|\\b"}if(x.e){x.eR=f(y,x.e)}}if(x.i){x.iR=f(y,x.i)}if(x.r===undefined){x.r=1}if(!x.c){x.c=[]}x.compiled=true;for(var t=0;t<x.c.length;t++){if(x.c[t]=="self"){x.c[t]=x}q(x.c[t],y,false)}if(x.starts){q(x.starts,y,false)}}for(var p in e){if(!e.hasOwnProperty(p)){continue}q(e[p].dM,e[p],true)}}function d(B,C){if(!j.called){j();j.called=true}function q(r,M){for(var L=0;L<M.c.length;L++){if((M.c[L].bR.exec(r)||[null])[0]==r){return M.c[L]}}}function v(L,r){if(D[L].e&&D[L].eR.test(r)){return 1}if(D[L].eW){var M=v(L-1,r);return M?M+1:0}return 0}function w(r,L){return L.i&&L.iR.test(r)}function K(N,O){var M=[];for(var L=0;L<N.c.length;L++){M.push(N.c[L].b)}var r=D.length-1;do{if(D[r].e){M.push(D[r].e)}r--}while(D[r+1].eW);if(N.i){M.push(N.i)}return f(O,M.join("|"),true)}function p(M,L){var N=D[D.length-1];if(!N.t){N.t=K(N,E)}N.t.lastIndex=L;var r=N.t.exec(M);return r?[M.substr(L,r.index-L),r[0],false]:[M.substr(L),"",true]}function z(N,r){var L=E.cI?r[0].toLowerCase():r[0];var M=N.k[L];if(M&&M instanceof Array){return M}return false}function F(L,P){L=m(L);if(!P.k){return L}var r="";var O=0;P.lR.lastIndex=0;var M=P.lR.exec(L);while(M){r+=L.substr(O,M.index-O);var N=z(P,M);if(N){x+=N[1];r+='<span class="'+N[0]+'">'+M[0]+"</span>"}else{r+=M[0]}O=P.lR.lastIndex;M=P.lR.exec(L)}return r+L.substr(O,L.length-O)}function J(L,M){if(M.sL&&e[M.sL]){var r=d(M.sL,L);x+=r.keyword_count;return r.value}else{return F(L,M)}}function I(M,r){var L=M.cN?'<span class="'+M.cN+'">':"";if(M.rB){y+=L;M.buffer=""}else{if(M.eB){y+=m(r)+L;M.buffer=""}else{y+=L;M.buffer=r}}D.push(M);A+=M.r}function G(N,M,Q){var R=D[D.length-1];if(Q){y+=J(R.buffer+N,R);return false}var P=q(M,R);if(P){y+=J(R.buffer+N,R);I(P,M);return P.rB}var L=v(D.length-1,M);if(L){var O=R.cN?"</span>":"";if(R.rE){y+=J(R.buffer+N,R)+O}else{if(R.eE){y+=J(R.buffer+N,R)+O+m(M)}else{y+=J(R.buffer+N+M,R)+O}}while(L>1){O=D[D.length-2].cN?"</span>":"";y+=O;L--;D.length--}var r=D[D.length-1];D.length--;D[D.length-1].buffer="";if(r.starts){I(r.starts,"")}return R.rE}if(w(M,R)){throw"Illegal"}}var E=e[B];var D=[E.dM];var A=0;var x=0;var y="";try{var s,u=0;E.dM.buffer="";do{s=p(C,u);var t=G(s[0],s[1],s[2]);u+=s[0].length;if(!t){u+=s[1].length}}while(!s[2]);if(D.length>1){throw"Illegal"}return{r:A,keyword_count:x,value:y}}catch(H){if(H=="Illegal"){return{r:0,keyword_count:0,value:m(C)}}else{throw H}}}function g(t){var p={keyword_count:0,r:0,value:m(t)};var r=p;for(var q in e){if(!e.hasOwnProperty(q)){continue}var s=d(q,t);s.language=q;if(s.keyword_count+s.r>r.keyword_count+r.r){r=s}if(s.keyword_count+s.r>p.keyword_count+p.r){r=p;p=s}}if(r.language){p.second_best=r}return p}function i(r,q,p){if(q){r=r.replace(/^((<[^>]+>|\t)+)/gm,function(t,w,v,u){return w.replace(/\t/g,q)})}if(p){r=r.replace(/\n/g,"<br>")}return r}function n(t,w,r){var x=h(t,r);var v=a(t);var y,s;if(v){y=d(v,x)}else{return}var q=c(t);if(q.length){s=document.createElement("pre");s.innerHTML=y.value;y.value=k(q,c(s),x)}y.value=i(y.value,w,r);var u=t.className;if(!u.match("(\\s|^)(language-)?"+v+"(\\s|$)")){u=u?(u+" "+v):v}if(/MSIE [678]/.test(navigator.userAgent)&&t.tagName=="CODE"&&t.parentNode.tagName=="PRE"){s=t.parentNode;var p=document.createElement("div");p.innerHTML="<pre><code>"+y.value+"</code></pre>";t=p.firstChild.firstChild;p.firstChild.cN=s.cN;s.parentNode.replaceChild(p.firstChild,s)}else{t.innerHTML=y.value}t.className=u;t.result={language:v,kw:y.keyword_count,re:y.r};if(y.second_best){t.second_best={language:y.second_best.language,kw:y.second_best.keyword_count,re:y.second_best.r}}}function o(){if(o.called){return}o.called=true;var r=document.getElementsByTagName("pre");for(var p=0;p<r.length;p++){var q=b(r[p]);if(q){n(q,hljs.tabReplace)}}}function l(){if(window.addEventListener){window.addEventListener("DOMContentLoaded",o,false);window.addEventListener("load",o,false)}else{if(window.attachEvent){window.attachEvent("onload",o)}else{window.onload=o}}}var e={};this.LANGUAGES=e;this.highlight=d;this.highlightAuto=g;this.fixMarkup=i;this.highlightBlock=n;this.initHighlighting=o;this.initHighlightingOnLoad=l;this.IR="[a-zA-Z][a-zA-Z0-9_]*";this.UIR="[a-zA-Z_][a-zA-Z0-9_]*";this.NR="\\b\\d+(\\.\\d+)?";this.CNR="\\b(0[xX][a-fA-F0-9]+|(\\d+(\\.\\d*)?|\\.\\d+)([eE][-+]?\\d+)?)";this.BNR="\\b(0b[01]+)";this.RSR="!|!=|!==|%|%=|&|&&|&=|\\*|\\*=|\\+|\\+=|,|\\.|-|-=|/|/=|:|;|<|<<|<<=|<=|=|==|===|>|>=|>>|>>=|>>>|>>>=|\\?|\\[|\\{|\\(|\\^|\\^=|\\||\\|=|\\|\\||~";this.ER="(?![\\s\\S])";this.BE={b:"\\\\.",r:0};this.ASM={cN:"string",b:"'",e:"'",i:"\\n",c:[this.BE],r:0};this.QSM={cN:"string",b:'"',e:'"',i:"\\n",c:[this.BE],r:0};this.CLCM={cN:"comment",b:"//",e:"$"};this.CBLCLM={cN:"comment",b:"/\\*",e:"\\*/"};this.HCM={cN:"comment",b:"#",e:"$"};this.NM={cN:"number",b:this.NR,r:0};this.CNM={cN:"number",b:this.CNR,r:0};this.BNM={cN:"number",b:this.BNR,r:0};this.inherit=function(r,s){var p={};for(var q in r){p[q]=r[q]}if(s){for(var q in s){p[q]=s[q]}}return p}}();hljs.LANGUAGES.cpp=function(){var a={keyword:{"false":1,"int":1,"float":1,"while":1,"private":1,"char":1,"catch":1,"export":1,virtual:1,operator:2,sizeof:2,dynamic_cast:2,typedef:2,const_cast:2,"const":1,struct:1,"for":1,static_cast:2,union:1,namespace:1,unsigned:1,"long":1,"throw":1,"volatile":2,"static":1,"protected":1,bool:1,template:1,mutable:1,"if":1,"public":1,friend:2,"do":1,"return":1,"goto":1,auto:1,"void":2,"enum":1,"else":1,"break":1,"new":1,extern:1,using:1,"true":1,"class":1,asm:1,"case":1,typeid:1,"short":1,reinterpret_cast:2,"default":1,"double":1,register:1,explicit:1,signed:1,typename:1,"try":1,"this":1,"switch":1,"continue":1,wchar_t:1,inline:1,"delete":1,alignof:1,char16_t:1,char32_t:1,constexpr:1,decltype:1,noexcept:1,nullptr:1,static_assert:1,thread_local:1,restrict:1,_Bool:1,complex:1},built_in:{std:1,string:1,cin:1,cout:1,cerr:1,clog:1,stringstream:1,istringstream:1,ostringstream:1,auto_ptr:1,deque:1,list:1,queue:1,stack:1,vector:1,map:1,set:1,bitset:1,multiset:1,multimap:1,unordered_set:1,unordered_map:1,unordered_multiset:1,unordered_multimap:1,array:1,shared_ptr:1}};return{dM:{k:a,i:"</",c:[hljs.CLCM,hljs.CBLCLM,hljs.QSM,{cN:"string",b:"'\\\\?.",e:"'",i:"."},{cN:"number",b:"\\b(\\d+(\\.\\d*)?|\\.\\d+)(u|U|l|L|ul|UL|f|F)"},hljs.CNM,{cN:"preprocessor",b:"#",e:"$"},{cN:"stl_container",b:"\\b(deque|list|queue|stack|vector|map|set|bitset|multiset|multimap|unordered_map|unordered_set|unordered_multiset|unordered_multimap|array)\\s*<",e:">",k:a,r:10,c:["self"]}]}}}();hljs.LANGUAGES.r={dM:{c:[hljs.HCM,{cN:"number",b:"\\b0[xX][0-9a-fA-F]+[Li]?\\b",e:hljs.IMMEDIATE_RE,r:0},{cN:"number",b:"\\b\\d+(?:[eE][+\\-]?\\d*)?L\\b",e:hljs.IMMEDIATE_RE,r:0},{cN:"number",b:"\\b\\d+\\.(?!\\d)(?:i\\b)?",e:hljs.IMMEDIATE_RE,r:1},{cN:"number",b:"\\b\\d+(?:\\.\\d*)?(?:[eE][+\\-]?\\d*)?i?\\b",e:hljs.IMMEDIATE_RE,r:0},{cN:"number",b:"\\.\\d+(?:[eE][+\\-]?\\d*)?i?\\b",e:hljs.IMMEDIATE_RE,r:1},{cN:"keyword",b:"(?:tryCatch|library|setGeneric|setGroupGeneric)\\b",e:hljs.IMMEDIATE_RE,r:10},{cN:"keyword",b:"\\.\\.\\.",e:hljs.IMMEDIATE_RE,r:10},{cN:"keyword",b:"\\.\\.\\d+(?![\\w.])",e:hljs.IMMEDIATE_RE,r:10},{cN:"keyword",b:"\\b(?:function)",e:hljs.IMMEDIATE_RE,r:2},{cN:"keyword",b:"(?:if|in|break|next|repeat|else|for|return|switch|while|try|stop|warning|require|attach|detach|source|setMethod|setClass)\\b",e:hljs.IMMEDIATE_RE,r:1},{cN:"literal",b:"(?:NA|NA_integer_|NA_real_|NA_character_|NA_complex_)\\b",e:hljs.IMMEDIATE_RE,r:10},{cN:"literal",b:"(?:NULL|TRUE|FALSE|T|F|Inf|NaN)\\b",e:hljs.IMMEDIATE_RE,r:1},{cN:"identifier",b:"[a-zA-Z.][a-zA-Z0-9._]*\\b",e:hljs.IMMEDIATE_RE,r:0},{cN:"operator",b:"<\\-(?!\\s*\\d)",e:hljs.IMMEDIATE_RE,r:2},{cN:"operator",b:"\\->|<\\-",e:hljs.IMMEDIATE_RE,r:1},{cN:"operator",b:"%%|~",e:hljs.IMMEDIATE_RE},{cN:"operator",b:">=|<=|==|!=|\\|\\||&&|=|\\+|\\-|\\*|/|\\^|>|<|!|&|\\||\\$|:",e:hljs.IMMEDIATE_RE,r:0},{cN:"operator",b:"%",e:"%",i:"\\n",r:1},{cN:"identifier",b:"`",e:"`",r:0},{cN:"string",b:'"',e:'"',c:[hljs.BE],r:0},{cN:"string",b:"'",e:"'",c:[hljs.BE],r:0},{cN:"paren",b:"[[({\\])}]",e:hljs.IMMEDIATE_RE,r:0}]}};
hljs.initHighlightingOnLoad();
</script>




</head>

<body>
<h2>Getting started</h2>

<p>Install the <code>dplyr</code> package using </p>

<pre><code class="r">install.packages(&quot;dplyr&quot;)
</code></pre>

<p>Change your working directory (see below). </p>

<p>Save these to your working directory:</p>

<ul>
<li><a href="lab02.R">lab02.R</a></li>
<li><a href="experiments.csv">experiments.csv</a></li>
<li><a href="treatment_codes.csv">treatment_codes.csv</a></li>
</ul>

<h2><a name="reading">Reading Data into R</a></h2>

<p>In this section, we will learn how to read in csv or Excel files into R. 
We focus on csv files because they are simplest to import, 
they can be easily exported from Excel (or other software), 
and they are portable, 
i.e. they can be used in other software.</p>

<h3><a name="working_directory">Changing your working directory</a></h3>

<p>One of the first tasks after starting R is to change the working directory. 
To set,</p>

<ul>
<li>in RStudio: Session &gt; Set Working Directory &gt; Choose Directory&hellip; (Ctrl + Shift + H)</li>
<li>in R GUI (Windows): File &gt; Change Dir&hellip; </li>
<li>in R GUI (Mac): Misc &gt; Change Working Directory&hellip;</li>
</ul>

<p>Or, you can just run the following command</p>

<pre><code class="r">setwd(choose.dir(getwd()))
</code></pre>

<p>Make sure you have write access to this directory. </p>

<h3>Reading data into R</h3>

<p>Data are stored in many different formats. 
I will focus on data stored in a csv file, 
but mention approaches to reading in
data stored in Excel, SAS, Stata, SPSS, and database formats.</p>

<h4>Reading a csv file into R</h4>

<p>The most common way I read data into R is through a csv file. 
csv stands for comma-separated value file and is a standard file format for
data. 
The utils package (which is installed and loaded with base R) has a 
function called <code>read.csv</code> for reading csv files into R. 
For example, </p>

<pre><code class="r">experiments = read.csv(&quot;experiments.csv&quot;)
</code></pre>

<p>In order for this code to execute correctly, 
you need to have the <a href="experiments.csv">experiments.csv</a> in your working 
directory.</p>

<p>This created a <code>data.frame</code> object in R called <code>experiments</code>. </p>

<p>The utils package has the <code>read.table()</code> function which is a more general 
function for reading data into R and it has many options. 
We could have gotten the same results if we had used the following code:</p>

<pre><code class="r">experiments2 = read.table(&quot;experiments.csv&quot;, 
                 header=TRUE, # There is a header.
                 sep=&quot;,&quot;)     # The column delimiter is a comma.
</code></pre>

<p>To check if the two data sets are equal, use the following</p>

<pre><code class="r">all.equal(experiments, experiments2)
</code></pre>

<pre><code>## [1] TRUE
</code></pre>

<p>The <code>read.csv</code> function is available in base R, but these days I will often
use the <code>read_csv</code> function in the 
<a href="https://cran.r-project.org/web/packages/readr/index.html">readr</a>.
See below for how to install packages using the <code>install.packages</code> function.</p>

<pre><code class="r">install.packages(&quot;readr&quot;) # run this command if the readr package is not installed
library(&#39;readr&#39;)
experiments &lt;- read_csv(&quot;experiments.csv&quot;)
</code></pre>

<p>The two main differences are </p>

<ul>
<li>this function does NOT make R friendly column names (and therefore the column names are &ldquo;pretty&rdquo;)</li>
<li>this function does NOT turn strings into factors</li>
</ul>

<h4>Activity</h4>

<p>Read the <a href="treatment_codes.csv">treatment_codes.csv</a> into R 
and save it into an R object named <code>treatment_codes</code>.
If you have extra time, try to figure out how to use the <code>read_csv</code> function
from the <code>readr</code> package to read the file in.</p>

<p><details><summary>Click for solution</summary>  </p>

<pre><code class="r">treatment_codes &lt;- read.csv(&quot;treatment_codes.csv&quot;)
</code></pre>

<pre><code class="r">install.packages(&quot;readr&quot;) # only need to do this once
library(&quot;readr&quot;)          # need to do this every R session
treatment_codes &lt;- read_csv(&quot;treatment_codes.csv&quot;)
</code></pre>

<p></details></p>

<h3><a name="excel">Reading Excel files</a></h3>

<p>My main suggestion for reading Excel files into R is to </p>

<ol>
<li>Save the Excel file as a csv</li>
<li>Read the csv file into R using <code>read.csv</code></li>
</ol>

<p>This approach will work regardless of any changes Excel makes in its document 
structure.</p>

<p>Reading an Excel file into R is done using the <code>read_excel</code> function from 
the <a href="https://cran.r-project.org/web/packages/readxl/index.html">readxl</a> R package. 
Unfortunately many scenarios can cause this process to not work. 
When it works, it looks like this</p>

<pre><code class="r">install.packages(&#39;readxl&#39;)
library(&#39;xl&#39;)
d = read_excel(&quot;filename.xlsx&quot;, sheet = 1) # or
d = read_excel(&quot;filename.xlsx&quot;, sheet =&quot;sheetName&quot;)
</code></pre>

<p>Again, if these approaches don&#39;t work, you can <code>Save as...</code> a csv file in Excel.</p>

<h3>Read SAS, Stata, or SPSS data files</h3>

<p>The <code>haven</code> package provides functionality to read in SAS, Stata, and SPSS 
files. 
An example of reading a SAS file is</p>

<pre><code class="r">install.packages(&#39;haven&#39;)
library(&#39;haven&#39;)
d = read_sas(&#39;filename.sas7bdat&#39;)
</code></pre>

<h4>Read a database file</h4>

<p>There are many different types of databases, so the code you will need will be
specific to the type of database you are trying to access. </p>

<p>The <a href="https://cran.r-project.org/web/packages/dplyr/index.html">dplyr</a> package,<br/>
which we will discussing today, has a <a href="https://cran.r-project.org/web/packages/dplyr/vignettes/databases.html">number of functions to read from some 
databases</a>.
The code will look something like</p>

<pre><code class="r">library(&#39;dplyr&#39;)
my_db &lt;- src_sqlite(&quot;my_db.sqlite3&quot;, create = T)
</code></pre>

<p>The <a href="https://cran.r-project.org/web/packages/RODBC/index.html">RODBC</a> package 
has a 
<a href="http://www.statmethods.net/input/dbinterface.html">number of functions to read from some databases</a>.
The code might look something like</p>

<pre><code class="r">install.packages(&quot;RODBC&quot;)
library(&#39;RODBC&#39;)

# RODBC Example
# import 2 tables (Crime and Punishment) from a DBMS
# into R data frames (and call them crimedat and pundat)

library(RODBC)
myconn &lt;-odbcConnect(&quot;mydsn&quot;, uid=&quot;Rob&quot;, pwd=&quot;aardvark&quot;)
crimedat &lt;- sqlFetch(myconn, &quot;Crime&quot;)
pundat &lt;- sqlQuery(myconn, &quot;select * from Punishment&quot;)
close(myconn)
</code></pre>

<h2>Manipulating <code>data.frame</code>s in R</h2>

<p>Some basic <code>data.frame</code> information is available using base R functions. 
But manipulating the <code>data.frame</code> becomes a lot easier using the 
<a href="https://cran.r-project.org/web/packages/dplyr/index.html">dplyr</a>.</p>

<p>You can check to see if a package is installed, by running</p>

<pre><code class="r">library(&quot;dplyr&quot;, quietly = TRUE) # if you don&#39;t use 
</code></pre>

<pre><code>## 
## Attaching package: &#39;dplyr&#39;
</code></pre>

<pre><code>## The following objects are masked from &#39;package:stats&#39;:
## 
##     filter, lag
</code></pre>

<pre><code>## The following objects are masked from &#39;package:base&#39;:
## 
##     intersect, setdiff, setequal, union
</code></pre>

<p>If you get an error, you will likely need to install the package and
then re-run the previous command.</p>

<pre><code class="r">install.packages(&quot;dplyr&quot;)
</code></pre>

<h3>Basic <code>data.frame</code> information</h3>

<p>The dimensions of the <code>data.frame</code> can be found using <code>dim</code>, <code>nrow</code>, and <code>ncol</code>.</p>

<pre><code class="r">dim(experiments)
</code></pre>

<pre><code>## [1] 1560    7
</code></pre>

<pre><code class="r">nrow(experiments)
</code></pre>

<pre><code>## [1] 1560
</code></pre>

<pre><code class="r">ncol(experiments)
</code></pre>

<pre><code>## [1] 7
</code></pre>

<p>The contents of the <code>data.frame</code> can be assessed using the following functions:</p>

<pre><code class="r">names(experiments)
</code></pre>

<pre><code>## [1] &quot;code&quot;           &quot;rep&quot;            &quot;win&quot;            &quot;n_cards_played&quot;
## [5] &quot;n_suns_played&quot;  &quot;owl_score&quot;      &quot;n_owls_left&quot;
</code></pre>

<pre><code class="r">head(experiments)
</code></pre>

<pre><code>##   code rep   win n_cards_played n_suns_played owl_score n_owls_left
## 1   AI   8  TRUE             24             8         0           0
## 2   TV   2  TRUE             33             9         0           0
## 3   JP   5 FALSE             40            13        18           4
## 4   EC   5  TRUE             37            11         0           0
## 5   MW   3  TRUE             28            10         0           0
## 6   JC   1  TRUE             32             8         0           0
</code></pre>

<pre><code class="r">tail(experiments)
</code></pre>

<pre><code>##      code rep   win n_cards_played n_suns_played owl_score n_owls_left
## 1555   FG   9  TRUE             38            12         0           0
## 1556   IG  10 FALSE             40            13         1           1
## 1557   LW   9 FALSE             33            13        73           4
## 1558   OZ   4 FALSE             25            13        86           5
## 1559   BX   1  TRUE             29            11         0           0
## 1560   OV   6  TRUE             32            11         0           0
</code></pre>

<pre><code class="r">str(experiments)
</code></pre>

<pre><code>## &#39;data.frame&#39;:    1560 obs. of  7 variables:
##  $ code          : chr  &quot;AI&quot; &quot;TV&quot; &quot;JP&quot; &quot;EC&quot; ...
##  $ rep           : int  8 2 5 5 3 1 7 10 2 7 ...
##  $ win           : logi  TRUE TRUE FALSE TRUE TRUE TRUE ...
##  $ n_cards_played: int  24 33 40 37 28 32 26 34 24 37 ...
##  $ n_suns_played : int  8 9 13 11 10 8 7 13 7 13 ...
##  $ owl_score     : int  0 0 18 0 0 0 0 15 0 17 ...
##  $ n_owls_left   : int  0 0 4 0 0 0 0 5 0 3 ...
</code></pre>

<p>To start running some statistics on the <code>data.frame</code> a quick function is the 
<code>summary</code> function:</p>

<pre><code class="r">summary(experiments)
</code></pre>

<pre><code>##      code                rep           win          n_cards_played 
##  Length:1560        Min.   : 1.00   Mode :logical   Min.   : 8.00  
##  Class :character   1st Qu.: 3.00   FALSE:660       1st Qu.:24.00  
##  Mode  :character   Median : 5.00   TRUE :900       Median :32.00  
##                     Mean   : 5.49                   Mean   :30.33  
##                     3rd Qu.: 8.00                   3rd Qu.:37.00  
##                     Max.   :10.00                   Max.   :47.00  
##  n_suns_played     owl_score       n_owls_left   
##  Min.   : 0.00   Min.   :  0.00   Min.   :0.000  
##  1st Qu.: 8.00   1st Qu.:  0.00   1st Qu.:0.000  
##  Median :12.00   Median :  0.00   Median :0.000  
##  Mean   :10.35   Mean   : 16.81   Mean   :1.561  
##  3rd Qu.:13.00   3rd Qu.: 22.00   3rd Qu.:3.000  
##  Max.   :13.00   Max.   :162.00   Max.   :6.000
</code></pre>

<p>Notice (under <code>win</code> column) that R will tell you if any observations are 
<code>Not Available</code> using <code>NA</code>.</p>

<h3>Subsetting a <code>data.frame</code></h3>

<p>First, let&#39;s make sure the <code>dplyr</code> package is loaded 
and <code>experiments</code> is loaded.</p>

<pre><code class="r">library(&quot;dplyr&quot;)
experiments     &lt;- read.csv(&quot;experiments.csv&quot;)
</code></pre>

<p>There are numerous ways in <code>dplyr</code> to subset observations:</p>

<ul>
<li><code>filter()</code></li>
<li><code>distinct()</code></li>
<li><code>sample_frac()</code></li>
<li><code>sample_n()</code></li>
<li><code>slice()</code></li>
<li><code>top_n()</code></li>
</ul>

<p>By far the most common one for me is to <code>filter()</code>.
This function will return all rows that match a set of logical criteria. 
For example, perhaps we want to extract all observations with treatment code
<code>AI</code>.</p>

<pre><code class="r">experiments %&gt;%
  filter(code == &quot;AI&quot;) # notice the double equal
</code></pre>

<pre><code>##    code rep  win n_cards_played n_suns_played owl_score n_owls_left
## 1    AI   8 TRUE             24             8         0           0
## 2    AI   7 TRUE             26             7         0           0
## 3    AI  10 TRUE             23             6         0           0
## 4    AI   9 TRUE             25             7         0           0
## 5    AI   6 TRUE             26             7         0           0
## 6    AI   5 TRUE             26            10         0           0
## 7    AI   1 TRUE             31            11         0           0
## 8    AI   3 TRUE             23             7         0           0
## 9    AI   2 TRUE             29             8         0           0
## 10   AI   4 TRUE             25             5         0           0
</code></pre>

<p>You can also filter by multiple criteria. </p>

<pre><code class="r">experiments %&gt;%
  filter(win, n_cards_played &gt; 30) %&gt;% # win is already logical
  summary
</code></pre>

<pre><code>##      code                rep           win          n_cards_played 
##  Length:297         Min.   : 1.000   Mode:logical   Min.   :31.00  
##  Class :character   1st Qu.: 3.000   TRUE:297       1st Qu.:33.00  
##  Mode  :character   Median : 6.000                  Median :35.00  
##                     Mean   : 5.481                  Mean   :35.76  
##                     3rd Qu.: 8.000                  3rd Qu.:38.00  
##                     Max.   :10.000                  Max.   :45.00  
##  n_suns_played     owl_score  n_owls_left
##  Min.   : 7.00   Min.   :0   Min.   :0   
##  1st Qu.:10.00   1st Qu.:0   1st Qu.:0   
##  Median :11.00   Median :0   Median :0   
##  Mean   :10.86   Mean   :0   Mean   :0   
##  3rd Qu.:12.00   3rd Qu.:0   3rd Qu.:0   
##  Max.   :12.00   Max.   :0   Max.   :0
</code></pre>

<h4>Activity</h4>

<p>Use the <code>treatment_codes</code> <code>data.frame</code> to keep only observations that used the
<code>random</code> strategy and 6 owls. 
If you get done with this quickly, keep only observations that used 2 or more
owls but less than 6. </p>

<p><details><summary>Click for solution</summary> </p>

<pre><code class="r"># Read in data if you haven&#39;t done it already
treatment_codes &lt;- read.csv(&quot;treatment_codes.csv&quot;)

treatment_codes %&gt;%
  filter(strategy == &quot;random&quot;, n_owls == 6) %&gt;%
  summary
</code></pre>

<pre><code>##    n_players     n_owls  n_cards_per_player   strategy        
##  Min.   :2   Min.   :6   Min.   :2          Length:9          
##  1st Qu.:2   1st Qu.:6   1st Qu.:2          Class :character  
##  Median :3   Median :6   Median :3          Mode  :character  
##  Mean   :3   Mean   :6   Mean   :3                            
##  3rd Qu.:4   3rd Qu.:6   3rd Qu.:4                            
##  Max.   :4   Max.   :6   Max.   :4                            
##      code          
##  Length:9          
##  Class :character  
##  Mode  :character  
##                    
##                    
## 
</code></pre>

<pre><code class="r">treatment_codes %&gt;%
  filter(n_owls &gt;= 2, n_owls &lt; 6) %&gt;%
  summary
</code></pre>

<pre><code>##    n_players     n_owls     n_cards_per_player   strategy        
##  Min.   :2   Min.   :2.00   Min.   :2          Length:108        
##  1st Qu.:2   1st Qu.:2.75   1st Qu.:2          Class :character  
##  Median :3   Median :3.50   Median :3          Mode  :character  
##  Mean   :3   Mean   :3.50   Mean   :3                            
##  3rd Qu.:4   3rd Qu.:4.25   3rd Qu.:4                            
##  Max.   :4   Max.   :5.00   Max.   :4                            
##      code          
##  Length:108        
##  Class :character  
##  Mode  :character  
##                    
##                    
## 
</code></pre>

<p></details></p>

<h3>Subset the columns</h3>

<p>If we want to subset the columns, we use the <code>select()</code> function. 
If used by itself, then it will keep any named columns and remove any names 
pre-fixed with a &ldquo;-&rdquo;. </p>

<pre><code class="r">experiments %&gt;% 
  select(n_cards_played, n_suns_played, n_owls_left) %&gt;%
  names
</code></pre>

<pre><code>## [1] &quot;n_cards_played&quot; &quot;n_suns_played&quot;  &quot;n_owls_left&quot;
</code></pre>

<pre><code class="r">experiments %&gt;%
  select(-code, -rep, -win, -owl_score) %&gt;%
  names
</code></pre>

<pre><code>## [1] &quot;n_cards_played&quot; &quot;n_suns_played&quot;  &quot;n_owls_left&quot;
</code></pre>

<p>Since there are still many rows here, I only print out the column names.</p>

<p>Sometimes, it would be more efficient to perform some <em>fuzzy</em> matching using 
one of these functions:</p>

<ul>
<li><code>contains()</code></li>
<li><code>ends_with()</code></li>
<li><code>everything()</code></li>
<li><code>matches()</code></li>
<li><code>num_range()</code></li>
<li><code>one_of()</code></li>
<li><code>starts_with()</code></li>
</ul>

<p>For example, keep only columns that start with &ldquo;n_&rdquo;</p>

<pre><code class="r">experiments %&gt;% 
  select(starts_with(&quot;n_&quot;)) %&gt;%
  names
</code></pre>

<pre><code>## [1] &quot;n_cards_played&quot; &quot;n_suns_played&quot;  &quot;n_owls_left&quot;
</code></pre>

<h4>Activity</h4>

<p>Use the <code>treatment_codes</code> <code>data.frame</code> to extract all the codes (and only codes)
for treatments that had two players and three owls. </p>

<p><details><summary>Click for solution</summary> </p>

<pre><code class="r"># Read in the data if you haven&#39;t already
treatment_codes &lt;- read.csv(&quot;treatment_codes.csv&quot;)

treatment_codes %&gt;%
  filter(n_players == 2, n_owls == 3) %&gt;%
  select(code)
</code></pre>

<pre><code>##   code
## 1   WW
## 2   DU
## 3   XC
## 4   RG
## 5   GB
## 6   WH
## 7   JC
## 8   YQ
## 9   AU
</code></pre>

<p></details></p>

<h3>Making new variables</h3>

<p>Proper data management requires that raw data remain raw and that scripts are
written to create analyzable data sets. 
These scripts will often need to construct new variables for future analyses.
The <code>dplyr</code> mutate function can be used to add new columns to the <code>data.frame</code>.</p>

<pre><code class="r">experiments %&gt;% 
  mutate(suns_spots_remaining   = 13 - n_suns_played,             # there are 13 sun spots
         average_owl_position   = owl_score / n_owls_left) %&gt;% 
  head
</code></pre>

<pre><code>##   code rep   win n_cards_played n_suns_played owl_score n_owls_left
## 1   AI   8  TRUE             24             8         0           0
## 2   TV   2  TRUE             33             9         0           0
## 3   JP   5 FALSE             40            13        18           4
## 4   EC   5  TRUE             37            11         0           0
## 5   MW   3  TRUE             28            10         0           0
## 6   JC   1  TRUE             32             8         0           0
##   suns_spots_remaining average_owl_position
## 1                    5                  NaN
## 2                    4                  NaN
## 3                    0                  4.5
## 4                    2                  NaN
## 5                    3                  NaN
## 6                    5                  NaN
</code></pre>

<p>Notice the <code>NaN</code> when we divided by zero. 
If there are no owls left, then it makes more sense that the average owl 
position is zero (which indicates the nest). </p>

<pre><code class="r">experiments %&gt;% 
  mutate(suns_spots_remaining   = 13 - n_suns_played,
         average_owl_position   = owl_score / n_owls_left,
         average_owl_position   = ifelse(is.nan(average_owl_position), 
                                         0,                            # return 0 if NaN
                                         average_owl_position)) %&gt;%    # otherwise leave alone
  head
</code></pre>

<pre><code>##   code rep   win n_cards_played n_suns_played owl_score n_owls_left
## 1   AI   8  TRUE             24             8         0           0
## 2   TV   2  TRUE             33             9         0           0
## 3   JP   5 FALSE             40            13        18           4
## 4   EC   5  TRUE             37            11         0           0
## 5   MW   3  TRUE             28            10         0           0
## 6   JC   1  TRUE             32             8         0           0
##   suns_spots_remaining average_owl_position
## 1                    5                  0.0
## 2                    4                  0.0
## 3                    0                  4.5
## 4                    2                  0.0
## 5                    3                  0.0
## 6                    5                  0.0
</code></pre>

<h4>Activity</h4>

<p>For each observation, calculate the number of non sun cards played.</p>

<p><details><summary>Click for solution</summary> </p>

<pre><code class="r">experiments %&gt;% 
  mutate(n_non_sun_cards_played = n_cards_played - n_suns_played) %&gt;%    
  head
</code></pre>

<pre><code>##   code rep   win n_cards_played n_suns_played owl_score n_owls_left
## 1   AI   8  TRUE             24             8         0           0
## 2   TV   2  TRUE             33             9         0           0
## 3   JP   5 FALSE             40            13        18           4
## 4   EC   5  TRUE             37            11         0           0
## 5   MW   3  TRUE             28            10         0           0
## 6   JC   1  TRUE             32             8         0           0
##   n_non_sun_cards_played
## 1                     16
## 2                     24
## 3                     27
## 4                     26
## 5                     18
## 6                     24
</code></pre>

<p></details></p>

<h3>Summarizing data</h3>

<p>We will often want to summarize large <code>data.frame</code>s. 
The <code>dplyr</code> <code>summarize</code> function will allow us to do this summarization. </p>

<pre><code class="r">experiments %&gt;%
  summarize(proportion_wins     = mean(win),
            mean_cards_played   = mean(  n_cards_played),
            median_cards_played = median(n_cards_played),
            min_cards_played    = min(   n_cards_played),
            max_cards_played    = max(   n_cards_played),
            sd_cards_played     = sd(    n_cards_played),
            var_cards_played    = var(   n_cards_played))
</code></pre>

<pre><code>##   proportion_wins mean_cards_played median_cards_played min_cards_played
## 1       0.5769231          30.32949                  32                8
##   max_cards_played sd_cards_played var_cards_played
## 1               47          9.0673         82.21594
</code></pre>

<p>Often, we will want to perform these summarizations on groups. 
In order to do this we will first</p>

<ol>
<li>Group the <code>data.frame</code> and then</li>
<li>Perform the summarization within each group</li>
</ol>

<pre><code class="r">experiments %&gt;%
  group_by(win) %&gt;%
  summarize(mean_cards_played   = mean(  n_cards_played),
            median_cards_played = median(n_cards_played)) %&gt;%
  ungroup()  # this isn&#39;t necessary here, but there may be times when you want to ungroup
</code></pre>

<pre><code>## `summarise()` ungrouping output (override with `.groups` argument)
</code></pre>

<pre><code>## # A tibble: 2 x 3
##   win   mean_cards_played median_cards_played
##   &lt;lgl&gt;             &lt;dbl&gt;               &lt;dbl&gt;
## 1 FALSE              36.5                  37
## 2 TRUE               25.8                  26
</code></pre>

<h4>Activity</h4>

<p>Calculate the average number of cards played after grouping by the 
number of owls left.</p>

<p><details><summary>Click for solution</summary> </p>

<pre><code class="r">experiments %&gt;%
  group_by(n_owls_left) %&gt;%
  summarize(mean_cards_played   = mean(  n_cards_played),
            median_cards_played = median(n_cards_played))
</code></pre>

<pre><code>## `summarise()` ungrouping output (override with `.groups` argument)
</code></pre>

<pre><code>## # A tibble: 7 x 3
##   n_owls_left mean_cards_played median_cards_played
##         &lt;int&gt;             &lt;dbl&gt;               &lt;dbl&gt;
## 1           0              25.8                26  
## 2           1              38.1                38  
## 3           2              36.3                37  
## 4           3              38.3                39.5
## 5           4              36.2                36  
## 6           5              35.9                36  
## 7           6              34.7                35
</code></pre>

<p></details></p>

<h3>Combining <code>data.frame</code>s</h3>

<p>The <code>experiment</code> <code>data.frame</code> is set up with <em>blinding</em>. 
In order to <em>unblind</em> these data, we will combine it with the <code>treatment_codes</code>
<code>data.frame</code>. </p>

<p>These two <code>data.frame</code>s have the <code>code</code> column in common:</p>

<pre><code class="r"># Read in the data if you haven&#39;t already
treatment_codes &lt;- read.csv(&quot;treatment_codes.csv&quot;)

names(experiments)
</code></pre>

<pre><code>## [1] &quot;code&quot;           &quot;rep&quot;            &quot;win&quot;            &quot;n_cards_played&quot;
## [5] &quot;n_suns_played&quot;  &quot;owl_score&quot;      &quot;n_owls_left&quot;
</code></pre>

<pre><code class="r">names(treatment_codes)
</code></pre>

<pre><code>## [1] &quot;n_players&quot;          &quot;n_owls&quot;             &quot;n_cards_per_player&quot;
## [4] &quot;strategy&quot;           &quot;code&quot;
</code></pre>

<p>So, now let&#39;s create a new <code>data.frame</code> that has combines the information in 
both of the other <code>data.frame</code>s. </p>

<pre><code class="r">results &lt;- experiments %&gt;%
  left_join(treatment_codes) # Keeps all rows in experiments and only the relevant rows in treatment_codes
</code></pre>

<pre><code>## Joining, by = &quot;code&quot;
</code></pre>

<p>You were told that it was combining by code (which is correct), but you might
have wanted to enforce that yourself.</p>

<pre><code class="r">results2 &lt;- experiments %&gt;%
  left_join(treatment_codes, by=&quot;code&quot;)
all.equal(results, results2)
</code></pre>

<pre><code>## [1] TRUE
</code></pre>

<p>The warning here is not important, although it is annoying. 
To avoid these warnings, I often use </p>

<pre><code class="r">treatment_codes &lt;- read.csv(&quot;treatment_codes.csv&quot;, stringsAsFactors = FALSE)
experiments     &lt;- read.csv(&quot;experiments.csv&quot;,     stringsAsFactors = FALSE)
</code></pre>

<p>or, using the 
<a href="https://cran.r-project.org/web/packages/readr/index.html">readr</a> package. </p>

<pre><code class="r">library(readr)
treatment_codes &lt;- read_csv(&quot;treatment_codes.csv&quot;)
experiments     &lt;- read_csv(&quot;experiments.csv&quot;)
</code></pre>

<p>There are other ways of joining <code>data.frame</code>s in R, but <code>left_join</code> is by far
the one that I use the most often. </p>

<h4>Activity - Putting it all together</h4>

<p>Perform the following:</p>

<ol>
<li>Combine the <code>experiment</code> and <code>treatment</code> <code>data.frame</code>s by column <code>code</code>.</li>
<li>Remove the <code>code</code> column (as it is no longer needed).</li>
<li>Subset to include only observations that</li>
</ol>

<ul>
<li>use the &ldquo;last owl farthest&rdquo; strategy,</li>
<li>have four or more owls, and</li>
<li>three players.</li>
</ul>

<ol>
<li>Calculate the number of games and win proportion after grouping by </li>
</ol>

<ul>
<li>number of owls</li>
<li>number of players</li>
<li>number of cards per player</li>
</ul>

<p><details><summary>Click for solution</summary>  </p>

<pre><code class="r">experiments %&gt;%
  left_join(treatment_codes, by=&quot;code&quot;) %&gt;%
  select(-code) %&gt;%
  filter(strategy == &quot;last_owl_farthest&quot;, 
         n_owls &gt;= 4,
         n_players == 3) %&gt;%
  group_by(n_players, n_owls, n_cards_per_player) %&gt;%
  summarize(
    n_games = n(),
    win_proportion = mean(win))
</code></pre>

<pre><code>## `summarise()` regrouping output by &#39;n_players&#39;, &#39;n_owls&#39; (override with `.groups` argument)
</code></pre>

<pre><code>## # A tibble: 9 x 5
## # Groups:   n_players, n_owls [3]
##   n_players n_owls n_cards_per_player n_games win_proportion
##       &lt;int&gt;  &lt;int&gt;              &lt;int&gt;   &lt;int&gt;          &lt;dbl&gt;
## 1         3      4                  2      10          0.9  
## 2         3      4                  3      10          0.8  
## 3         3      4                  4       9          0.556
## 4         3      5                  2      10          0.7  
## 5         3      5                  3       9          0.889
## 6         3      5                  4      10          0.3  
## 7         3      6                  2      10          0.4  
## 8         3      6                  3      10          0    
## 9         3      6                  4      10          0.1
</code></pre>

<p></details></p>

<h3><code>dplyr</code> cheat sheet</h3>

<p><a href="https://www.rstudio.com/wp-content/uploads/2015/02/data-wrangling-cheatsheet.pdf">Here</a> 
is a two-page summary (cheat sheet) of many <code>dplyr</code> commands.</p>

<pre><code>## Warning in file(con, &quot;r&quot;): cannot open file &#39;labData.Rmd&#39;: No such file or
## directory
</code></pre>

<pre><code>## Error in file(con, &quot;r&quot;): cannot open the connection
</code></pre>

</body>

</html>

