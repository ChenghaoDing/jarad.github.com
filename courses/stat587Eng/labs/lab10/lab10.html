<!DOCTYPE html>
<!-- saved from url=(0014)about:internet -->
<html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8"/>
<meta http-equiv="x-ua-compatible" content="IE=9" >

<title>ANOVA Table</title>

<style type="text/css">
body, td {
   font-family: sans-serif;
   background-color: white;
   font-size: 12px;
   margin: 8px;
}

tt, code, pre {
   font-family: 'DejaVu Sans Mono', 'Droid Sans Mono', 'Lucida Console', Consolas, Monaco, monospace;
}

h1 { 
   font-size:2.2em; 
}

h2 { 
   font-size:1.8em; 
}

h3 { 
   font-size:1.4em; 
}

h4 { 
   font-size:1.0em; 
}

h5 { 
   font-size:0.9em; 
}

h6 { 
   font-size:0.8em; 
}

a:visited {
   color: rgb(50%, 0%, 50%);
}

pre {	
   margin-top: 0;
   max-width: 95%;
   border: 1px solid #ccc;
   white-space: pre-wrap;
}

pre code {
   display: block; padding: 0.5em;
}

code.r, code.cpp {
   background-color: #F8F8F8;
}

table, td, th {
  border: none;
}

blockquote {
   color:#666666;
   margin:0;
   padding-left: 1em;
   border-left: 0.5em #EEE solid;
}

hr {
   height: 0px;
   border-bottom: none;
   border-top-width: thin;
   border-top-style: dotted;
   border-top-color: #999999;
}

@media print {
   * { 
      background: transparent !important; 
      color: black !important; 
      filter:none !important; 
      -ms-filter: none !important; 
   }

   body { 
      font-size:12pt; 
      max-width:100%; 
   }
       
   a, a:visited { 
      text-decoration: underline; 
   }

   hr { 
      visibility: hidden;
      page-break-before: always;
   }

   pre, blockquote { 
      padding-right: 1em; 
      page-break-inside: avoid; 
   }

   tr, img { 
      page-break-inside: avoid; 
   }

   img { 
      max-width: 100% !important; 
   }

   @page :left { 
      margin: 15mm 20mm 15mm 10mm; 
   }
     
   @page :right { 
      margin: 15mm 10mm 15mm 20mm; 
   }

   p, h2, h3 { 
      orphans: 3; widows: 3; 
   }

   h2, h3 { 
      page-break-after: avoid; 
   }
}

</style>

<!-- Styles for R syntax highlighter -->
<style type="text/css">
   pre .operator,
   pre .paren {
     color: rgb(104, 118, 135)
   }

   pre .literal {
     color: rgb(88, 72, 246)
   }

   pre .number {
     color: rgb(0, 0, 205);
   }

   pre .comment {
     color: rgb(76, 136, 107);
   }

   pre .keyword {
     color: rgb(0, 0, 255);
   }

   pre .identifier {
     color: rgb(0, 0, 0);
   }

   pre .string {
     color: rgb(3, 106, 7);
   }
</style>

<!-- R syntax highlighter -->
<script type="text/javascript">
var hljs=new function(){function m(p){return p.replace(/&/gm,"&amp;").replace(/</gm,"&lt;")}function f(r,q,p){return RegExp(q,"m"+(r.cI?"i":"")+(p?"g":""))}function b(r){for(var p=0;p<r.childNodes.length;p++){var q=r.childNodes[p];if(q.nodeName=="CODE"){return q}if(!(q.nodeType==3&&q.nodeValue.match(/\s+/))){break}}}function h(t,s){var p="";for(var r=0;r<t.childNodes.length;r++){if(t.childNodes[r].nodeType==3){var q=t.childNodes[r].nodeValue;if(s){q=q.replace(/\n/g,"")}p+=q}else{if(t.childNodes[r].nodeName=="BR"){p+="\n"}else{p+=h(t.childNodes[r])}}}if(/MSIE [678]/.test(navigator.userAgent)){p=p.replace(/\r/g,"\n")}return p}function a(s){var r=s.className.split(/\s+/);r=r.concat(s.parentNode.className.split(/\s+/));for(var q=0;q<r.length;q++){var p=r[q].replace(/^language-/,"");if(e[p]){return p}}}function c(q){var p=[];(function(s,t){for(var r=0;r<s.childNodes.length;r++){if(s.childNodes[r].nodeType==3){t+=s.childNodes[r].nodeValue.length}else{if(s.childNodes[r].nodeName=="BR"){t+=1}else{if(s.childNodes[r].nodeType==1){p.push({event:"start",offset:t,node:s.childNodes[r]});t=arguments.callee(s.childNodes[r],t);p.push({event:"stop",offset:t,node:s.childNodes[r]})}}}}return t})(q,0);return p}function k(y,w,x){var q=0;var z="";var s=[];function u(){if(y.length&&w.length){if(y[0].offset!=w[0].offset){return(y[0].offset<w[0].offset)?y:w}else{return w[0].event=="start"?y:w}}else{return y.length?y:w}}function t(D){var A="<"+D.nodeName.toLowerCase();for(var B=0;B<D.attributes.length;B++){var C=D.attributes[B];A+=" "+C.nodeName.toLowerCase();if(C.value!==undefined&&C.value!==false&&C.value!==null){A+='="'+m(C.value)+'"'}}return A+">"}while(y.length||w.length){var v=u().splice(0,1)[0];z+=m(x.substr(q,v.offset-q));q=v.offset;if(v.event=="start"){z+=t(v.node);s.push(v.node)}else{if(v.event=="stop"){var p,r=s.length;do{r--;p=s[r];z+=("</"+p.nodeName.toLowerCase()+">")}while(p!=v.node);s.splice(r,1);while(r<s.length){z+=t(s[r]);r++}}}}return z+m(x.substr(q))}function j(){function q(x,y,v){if(x.compiled){return}var u;var s=[];if(x.k){x.lR=f(y,x.l||hljs.IR,true);for(var w in x.k){if(!x.k.hasOwnProperty(w)){continue}if(x.k[w] instanceof Object){u=x.k[w]}else{u=x.k;w="keyword"}for(var r in u){if(!u.hasOwnProperty(r)){continue}x.k[r]=[w,u[r]];s.push(r)}}}if(!v){if(x.bWK){x.b="\\b("+s.join("|")+")\\s"}x.bR=f(y,x.b?x.b:"\\B|\\b");if(!x.e&&!x.eW){x.e="\\B|\\b"}if(x.e){x.eR=f(y,x.e)}}if(x.i){x.iR=f(y,x.i)}if(x.r===undefined){x.r=1}if(!x.c){x.c=[]}x.compiled=true;for(var t=0;t<x.c.length;t++){if(x.c[t]=="self"){x.c[t]=x}q(x.c[t],y,false)}if(x.starts){q(x.starts,y,false)}}for(var p in e){if(!e.hasOwnProperty(p)){continue}q(e[p].dM,e[p],true)}}function d(B,C){if(!j.called){j();j.called=true}function q(r,M){for(var L=0;L<M.c.length;L++){if((M.c[L].bR.exec(r)||[null])[0]==r){return M.c[L]}}}function v(L,r){if(D[L].e&&D[L].eR.test(r)){return 1}if(D[L].eW){var M=v(L-1,r);return M?M+1:0}return 0}function w(r,L){return L.i&&L.iR.test(r)}function K(N,O){var M=[];for(var L=0;L<N.c.length;L++){M.push(N.c[L].b)}var r=D.length-1;do{if(D[r].e){M.push(D[r].e)}r--}while(D[r+1].eW);if(N.i){M.push(N.i)}return f(O,M.join("|"),true)}function p(M,L){var N=D[D.length-1];if(!N.t){N.t=K(N,E)}N.t.lastIndex=L;var r=N.t.exec(M);return r?[M.substr(L,r.index-L),r[0],false]:[M.substr(L),"",true]}function z(N,r){var L=E.cI?r[0].toLowerCase():r[0];var M=N.k[L];if(M&&M instanceof Array){return M}return false}function F(L,P){L=m(L);if(!P.k){return L}var r="";var O=0;P.lR.lastIndex=0;var M=P.lR.exec(L);while(M){r+=L.substr(O,M.index-O);var N=z(P,M);if(N){x+=N[1];r+='<span class="'+N[0]+'">'+M[0]+"</span>"}else{r+=M[0]}O=P.lR.lastIndex;M=P.lR.exec(L)}return r+L.substr(O,L.length-O)}function J(L,M){if(M.sL&&e[M.sL]){var r=d(M.sL,L);x+=r.keyword_count;return r.value}else{return F(L,M)}}function I(M,r){var L=M.cN?'<span class="'+M.cN+'">':"";if(M.rB){y+=L;M.buffer=""}else{if(M.eB){y+=m(r)+L;M.buffer=""}else{y+=L;M.buffer=r}}D.push(M);A+=M.r}function G(N,M,Q){var R=D[D.length-1];if(Q){y+=J(R.buffer+N,R);return false}var P=q(M,R);if(P){y+=J(R.buffer+N,R);I(P,M);return P.rB}var L=v(D.length-1,M);if(L){var O=R.cN?"</span>":"";if(R.rE){y+=J(R.buffer+N,R)+O}else{if(R.eE){y+=J(R.buffer+N,R)+O+m(M)}else{y+=J(R.buffer+N+M,R)+O}}while(L>1){O=D[D.length-2].cN?"</span>":"";y+=O;L--;D.length--}var r=D[D.length-1];D.length--;D[D.length-1].buffer="";if(r.starts){I(r.starts,"")}return R.rE}if(w(M,R)){throw"Illegal"}}var E=e[B];var D=[E.dM];var A=0;var x=0;var y="";try{var s,u=0;E.dM.buffer="";do{s=p(C,u);var t=G(s[0],s[1],s[2]);u+=s[0].length;if(!t){u+=s[1].length}}while(!s[2]);if(D.length>1){throw"Illegal"}return{r:A,keyword_count:x,value:y}}catch(H){if(H=="Illegal"){return{r:0,keyword_count:0,value:m(C)}}else{throw H}}}function g(t){var p={keyword_count:0,r:0,value:m(t)};var r=p;for(var q in e){if(!e.hasOwnProperty(q)){continue}var s=d(q,t);s.language=q;if(s.keyword_count+s.r>r.keyword_count+r.r){r=s}if(s.keyword_count+s.r>p.keyword_count+p.r){r=p;p=s}}if(r.language){p.second_best=r}return p}function i(r,q,p){if(q){r=r.replace(/^((<[^>]+>|\t)+)/gm,function(t,w,v,u){return w.replace(/\t/g,q)})}if(p){r=r.replace(/\n/g,"<br>")}return r}function n(t,w,r){var x=h(t,r);var v=a(t);var y,s;if(v){y=d(v,x)}else{return}var q=c(t);if(q.length){s=document.createElement("pre");s.innerHTML=y.value;y.value=k(q,c(s),x)}y.value=i(y.value,w,r);var u=t.className;if(!u.match("(\\s|^)(language-)?"+v+"(\\s|$)")){u=u?(u+" "+v):v}if(/MSIE [678]/.test(navigator.userAgent)&&t.tagName=="CODE"&&t.parentNode.tagName=="PRE"){s=t.parentNode;var p=document.createElement("div");p.innerHTML="<pre><code>"+y.value+"</code></pre>";t=p.firstChild.firstChild;p.firstChild.cN=s.cN;s.parentNode.replaceChild(p.firstChild,s)}else{t.innerHTML=y.value}t.className=u;t.result={language:v,kw:y.keyword_count,re:y.r};if(y.second_best){t.second_best={language:y.second_best.language,kw:y.second_best.keyword_count,re:y.second_best.r}}}function o(){if(o.called){return}o.called=true;var r=document.getElementsByTagName("pre");for(var p=0;p<r.length;p++){var q=b(r[p]);if(q){n(q,hljs.tabReplace)}}}function l(){if(window.addEventListener){window.addEventListener("DOMContentLoaded",o,false);window.addEventListener("load",o,false)}else{if(window.attachEvent){window.attachEvent("onload",o)}else{window.onload=o}}}var e={};this.LANGUAGES=e;this.highlight=d;this.highlightAuto=g;this.fixMarkup=i;this.highlightBlock=n;this.initHighlighting=o;this.initHighlightingOnLoad=l;this.IR="[a-zA-Z][a-zA-Z0-9_]*";this.UIR="[a-zA-Z_][a-zA-Z0-9_]*";this.NR="\\b\\d+(\\.\\d+)?";this.CNR="\\b(0[xX][a-fA-F0-9]+|(\\d+(\\.\\d*)?|\\.\\d+)([eE][-+]?\\d+)?)";this.BNR="\\b(0b[01]+)";this.RSR="!|!=|!==|%|%=|&|&&|&=|\\*|\\*=|\\+|\\+=|,|\\.|-|-=|/|/=|:|;|<|<<|<<=|<=|=|==|===|>|>=|>>|>>=|>>>|>>>=|\\?|\\[|\\{|\\(|\\^|\\^=|\\||\\|=|\\|\\||~";this.ER="(?![\\s\\S])";this.BE={b:"\\\\.",r:0};this.ASM={cN:"string",b:"'",e:"'",i:"\\n",c:[this.BE],r:0};this.QSM={cN:"string",b:'"',e:'"',i:"\\n",c:[this.BE],r:0};this.CLCM={cN:"comment",b:"//",e:"$"};this.CBLCLM={cN:"comment",b:"/\\*",e:"\\*/"};this.HCM={cN:"comment",b:"#",e:"$"};this.NM={cN:"number",b:this.NR,r:0};this.CNM={cN:"number",b:this.CNR,r:0};this.BNM={cN:"number",b:this.BNR,r:0};this.inherit=function(r,s){var p={};for(var q in r){p[q]=r[q]}if(s){for(var q in s){p[q]=s[q]}}return p}}();hljs.LANGUAGES.cpp=function(){var a={keyword:{"false":1,"int":1,"float":1,"while":1,"private":1,"char":1,"catch":1,"export":1,virtual:1,operator:2,sizeof:2,dynamic_cast:2,typedef:2,const_cast:2,"const":1,struct:1,"for":1,static_cast:2,union:1,namespace:1,unsigned:1,"long":1,"throw":1,"volatile":2,"static":1,"protected":1,bool:1,template:1,mutable:1,"if":1,"public":1,friend:2,"do":1,"return":1,"goto":1,auto:1,"void":2,"enum":1,"else":1,"break":1,"new":1,extern:1,using:1,"true":1,"class":1,asm:1,"case":1,typeid:1,"short":1,reinterpret_cast:2,"default":1,"double":1,register:1,explicit:1,signed:1,typename:1,"try":1,"this":1,"switch":1,"continue":1,wchar_t:1,inline:1,"delete":1,alignof:1,char16_t:1,char32_t:1,constexpr:1,decltype:1,noexcept:1,nullptr:1,static_assert:1,thread_local:1,restrict:1,_Bool:1,complex:1},built_in:{std:1,string:1,cin:1,cout:1,cerr:1,clog:1,stringstream:1,istringstream:1,ostringstream:1,auto_ptr:1,deque:1,list:1,queue:1,stack:1,vector:1,map:1,set:1,bitset:1,multiset:1,multimap:1,unordered_set:1,unordered_map:1,unordered_multiset:1,unordered_multimap:1,array:1,shared_ptr:1}};return{dM:{k:a,i:"</",c:[hljs.CLCM,hljs.CBLCLM,hljs.QSM,{cN:"string",b:"'\\\\?.",e:"'",i:"."},{cN:"number",b:"\\b(\\d+(\\.\\d*)?|\\.\\d+)(u|U|l|L|ul|UL|f|F)"},hljs.CNM,{cN:"preprocessor",b:"#",e:"$"},{cN:"stl_container",b:"\\b(deque|list|queue|stack|vector|map|set|bitset|multiset|multimap|unordered_map|unordered_set|unordered_multiset|unordered_multimap|array)\\s*<",e:">",k:a,r:10,c:["self"]}]}}}();hljs.LANGUAGES.r={dM:{c:[hljs.HCM,{cN:"number",b:"\\b0[xX][0-9a-fA-F]+[Li]?\\b",e:hljs.IMMEDIATE_RE,r:0},{cN:"number",b:"\\b\\d+(?:[eE][+\\-]?\\d*)?L\\b",e:hljs.IMMEDIATE_RE,r:0},{cN:"number",b:"\\b\\d+\\.(?!\\d)(?:i\\b)?",e:hljs.IMMEDIATE_RE,r:1},{cN:"number",b:"\\b\\d+(?:\\.\\d*)?(?:[eE][+\\-]?\\d*)?i?\\b",e:hljs.IMMEDIATE_RE,r:0},{cN:"number",b:"\\.\\d+(?:[eE][+\\-]?\\d*)?i?\\b",e:hljs.IMMEDIATE_RE,r:1},{cN:"keyword",b:"(?:tryCatch|library|setGeneric|setGroupGeneric)\\b",e:hljs.IMMEDIATE_RE,r:10},{cN:"keyword",b:"\\.\\.\\.",e:hljs.IMMEDIATE_RE,r:10},{cN:"keyword",b:"\\.\\.\\d+(?![\\w.])",e:hljs.IMMEDIATE_RE,r:10},{cN:"keyword",b:"\\b(?:function)",e:hljs.IMMEDIATE_RE,r:2},{cN:"keyword",b:"(?:if|in|break|next|repeat|else|for|return|switch|while|try|stop|warning|require|attach|detach|source|setMethod|setClass)\\b",e:hljs.IMMEDIATE_RE,r:1},{cN:"literal",b:"(?:NA|NA_integer_|NA_real_|NA_character_|NA_complex_)\\b",e:hljs.IMMEDIATE_RE,r:10},{cN:"literal",b:"(?:NULL|TRUE|FALSE|T|F|Inf|NaN)\\b",e:hljs.IMMEDIATE_RE,r:1},{cN:"identifier",b:"[a-zA-Z.][a-zA-Z0-9._]*\\b",e:hljs.IMMEDIATE_RE,r:0},{cN:"operator",b:"<\\-(?!\\s*\\d)",e:hljs.IMMEDIATE_RE,r:2},{cN:"operator",b:"\\->|<\\-",e:hljs.IMMEDIATE_RE,r:1},{cN:"operator",b:"%%|~",e:hljs.IMMEDIATE_RE},{cN:"operator",b:">=|<=|==|!=|\\|\\||&&|=|\\+|\\-|\\*|/|\\^|>|<|!|&|\\||\\$|:",e:hljs.IMMEDIATE_RE,r:0},{cN:"operator",b:"%",e:"%",i:"\\n",r:1},{cN:"identifier",b:"`",e:"`",r:0},{cN:"string",b:'"',e:'"',c:[hljs.BE],r:0},{cN:"string",b:"'",e:"'",c:[hljs.BE],r:0},{cN:"paren",b:"[[({\\])}]",e:hljs.IMMEDIATE_RE,r:0}]}};
hljs.initHighlightingOnLoad();
</script>


<!-- MathJax scripts -->
<script type="text/javascript" src="https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML">
</script>



</head>

<body>
<p>To follow along, use the <a href="lab10.R">lab10 code</a>.</p>

<p>Now load the packages</p>

<pre><code class="r">library(&quot;tidyverse&quot;)
</code></pre>

<pre><code>## -- Attaching packages ------------------------------------------- tidyverse 1.3.0 --
</code></pre>

<pre><code>## v ggplot2 3.3.2     v purrr   0.3.4
## v tibble  3.0.3     v dplyr   1.0.1
## v tidyr   1.1.1     v stringr 1.4.0
## v readr   1.3.1     v forcats 0.5.0
</code></pre>

<pre><code>## -- Conflicts ---------------------------------------------- tidyverse_conflicts() --
## x dplyr::filter() masks stats::filter()
## x dplyr::lag()    masks stats::lag()
</code></pre>

<pre><code class="r">library(&quot;Sleuth3&quot;)
</code></pre>

<h2>ANOVA Table</h2>

<p>To run an ANOVA in R, use the <code>anova()</code> function on an <code>lm</code> object. </p>

<pre><code class="r">m &lt;- lm(Lifetime ~ Diet, data = case0501)
anova(m)
</code></pre>

<pre><code>## Analysis of Variance Table
## 
## Response: Lifetime
##            Df Sum Sq Mean Sq F value    Pr(&gt;F)    
## Diet        5  12734  2546.8  57.104 &lt; 2.2e-16 ***
## Residuals 343  15297    44.6                      
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1
</code></pre>

<p>Note a few things about this table:</p>

<ul>
<li>It provides an organization for the F-test.</li>
<li>The coefficient of determination is 12734/(12734+15297).</li>
<li>There are 6 diets (Df+1).</li>
<li>There are 349 observations (sum(Df)+1). </li>
</ul>

<p>This F-test also shows up in the R regression output:</p>

<pre><code class="r">summary(m)
</code></pre>

<pre><code>## 
## Call:
## lm(formula = Lifetime ~ Diet, data = case0501)
## 
## Residuals:
##      Min       1Q   Median       3Q      Max 
## -25.5167  -3.3857   0.8143   5.1833  10.0143 
## 
## Coefficients:
##             Estimate Std. Error t value Pr(&gt;|t|)    
## (Intercept)  32.6912     0.8846  36.958  &lt; 2e-16 ***
## DietN/R40    12.4254     1.2352  10.059  &lt; 2e-16 ***
## DietN/R50     9.6060     1.1877   8.088 1.06e-14 ***
## DietNP       -5.2892     1.3010  -4.065 5.95e-05 ***
## DietR/R50    10.1945     1.2565   8.113 8.88e-15 ***
## Dietlopro     6.9945     1.2565   5.567 5.25e-08 ***
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1
## 
## Residual standard error: 6.678 on 343 degrees of freedom
## Multiple R-squared:  0.4543, Adjusted R-squared:  0.4463 
## F-statistic:  57.1 on 5 and 343 DF,  p-value: &lt; 2.2e-16
</code></pre>

<p>where the last line provides the F-statistic, the numerator and denominator 
degrees of freedom, and the associated p-value. 
The two models being compared here are the intercept-only model and the model
with all explanatory variables (in this case the indicator functions for all
but one Diet). </p>

<p>This F-test can be constructed manually by fitting these two models and using
the <code>anova()</code> function to compare the models. </p>

<pre><code class="r">m0 &lt;- lm(Lifetime ~ 1, data = case0501) # 1 indicates intercept 
anova(m0, m)
</code></pre>

<pre><code>## Analysis of Variance Table
## 
## Model 1: Lifetime ~ 1
## Model 2: Lifetime ~ Diet
##   Res.Df   RSS Df Sum of Sq      F    Pr(&gt;F)    
## 1    348 28031                                  
## 2    343 15297  5     12734 57.104 &lt; 2.2e-16 ***
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1
</code></pre>

<p>This table contains the information from the intercept-only model in row 1 and 
the information from the model with Diet, as a categorical variable, in row 2. </p>

<h4>Activity</h4>

<p>The <code>ex0920</code> data set contains information on the Kentucky Derby winners from
1896-2011.</p>

<ol>
<li>Fit a multiple regression model of Speed on Starters and the 7 level version of Track conditions.</li>
<li>Verify that the F-statistic in the <code>summary()</code> output of this multiple 
regression model compares the intercept-only model with the model with all 
of the explanatory variables. </li>
</ol>

<p>Bonus </p>

<ol>
<li>After completing this, take a look at the ANOVA table on the regression model 
and see if you can figure out what the different lines represent. </li>
</ol>

<p><details><summary>Click for solution</summary> </p>

<pre><code class="r">m0 &lt;- lm(Speed ~ 1,                data = ex0920)
m  &lt;- lm(Speed ~ Starters + Track, data = ex0920)
summary(m)
</code></pre>

<pre><code>## 
## Call:
## lm(formula = Speed ~ Starters + Track, data = ex0920)
## 
## Residuals:
##      Min       1Q   Median       3Q      Max 
## -1.93774 -0.27403  0.00487  0.39355  1.22224 
## 
## Coefficients:
##             Estimate Std. Error t value Pr(&gt;|t|)    
## (Intercept) 34.78998    0.60750  57.268  &lt; 2e-16 ***
## Starters     0.05500    0.01172   4.695 7.88e-06 ***
## TrackFast    0.96275    0.60800   1.583    0.116    
## TrackGood    0.47109    0.63658   0.740    0.461    
## TrackHeavy  -1.18250    0.64855  -1.823    0.071 .  
## TrackMuddy  -0.36418    0.65151  -0.559    0.577    
## TrackSloppy  0.37248    0.67538   0.552    0.582    
## TrackSlow   -0.20402    0.66177  -0.308    0.758    
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1
## 
## Residual standard error: 0.6002 on 108 degrees of freedom
## Multiple R-squared:  0.5815, Adjusted R-squared:  0.5544 
## F-statistic: 21.44 on 7 and 108 DF,  p-value: &lt; 2.2e-16
</code></pre>

<pre><code class="r">anova(m0, m)
</code></pre>

<pre><code>## Analysis of Variance Table
## 
## Model 1: Speed ~ 1
## Model 2: Speed ~ Starters + Track
##   Res.Df    RSS Df Sum of Sq      F    Pr(&gt;F)    
## 1    115 92.971                                  
## 2    108 38.909  7    54.062 21.437 &lt; 2.2e-16 ***
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1
</code></pre>

<p>Now take a look at the ANOVA table</p>

<pre><code class="r">anova(m)
</code></pre>

<pre><code>## Analysis of Variance Table
## 
## Response: Speed
##            Df Sum Sq Mean Sq F value    Pr(&gt;F)    
## Starters    1 15.999 15.9992  44.409 1.162e-09 ***
## Track       6 38.063  6.3439  17.609 3.914e-14 ***
## Residuals 108 38.909  0.3603                      
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1
</code></pre>

<p></details></p>

<h3>ANOVA with multiple explanatory variables</h3>

<p>The ANOVA table when multiple explanatory variables are included differs from
our one-way ANOVA table.</p>

<pre><code class="r">m &lt;- lm(Speed ~ Starters + Track, data = ex0920)
anova(m)
</code></pre>

<pre><code>## Analysis of Variance Table
## 
## Response: Speed
##            Df Sum Sq Mean Sq F value    Pr(&gt;F)    
## Starters    1 15.999 15.9992  44.409 1.162e-09 ***
## Track       6 38.063  6.3439  17.609 3.914e-14 ***
## Residuals 108 38.909  0.3603                      
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1
</code></pre>

<p>To determine what full and reduced models are used in constructing this ANOVA 
table, we will fit a variety of different models.</p>

<pre><code class="r">m0  &lt;- lm(Speed ~ 1,                data = ex0920)
mS  &lt;- lm(Speed ~ Starters,         data = ex0920)
mT  &lt;- lm(Speed ~            Track, data = ex0920)
mST &lt;- lm(Speed ~ Starters + Track, data = ex0920)
</code></pre>

<p>You might think the ANOVA table compares </p>

<ol>
<li>intercept-only model to the model with Starters</li>
<li>the Starters model to the Starters+Track model</li>
</ol>

<pre><code class="r">anova(m0, mS ) # we are looking to add (S)tarters to the model
</code></pre>

<pre><code>## Analysis of Variance Table
## 
## Model 1: Speed ~ 1
## Model 2: Speed ~ Starters
##   Res.Df    RSS Df Sum of Sq      F    Pr(&gt;F)    
## 1    115 92.971                                  
## 2    114 76.972  1    15.999 23.696 3.659e-06 ***
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1
</code></pre>

<pre><code class="r">anova(mS, mST) # we are looking to add (T)rack    to the model
</code></pre>

<pre><code>## Analysis of Variance Table
## 
## Model 1: Speed ~ Starters
## Model 2: Speed ~ Starters + Track
##   Res.Df    RSS Df Sum of Sq      F    Pr(&gt;F)    
## 1    114 76.972                                  
## 2    108 38.909  6    38.063 17.609 3.914e-14 ***
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1
</code></pre>

<p>We get identical results for the second comparison but not for the first. </p>

<p>The reason is what estimate of the error variance, \( \hat\sigma^2 \), is used.
If the models are all put together, then the error variance estimate is based 
on the fullest model in the list.
So the following will recreate the full ANOVA table.</p>

<pre><code class="r">anova(m0, mS, mST)
</code></pre>

<pre><code>## Analysis of Variance Table
## 
## Model 1: Speed ~ 1
## Model 2: Speed ~ Starters
## Model 3: Speed ~ Starters + Track
##   Res.Df    RSS Df Sum of Sq      F    Pr(&gt;F)    
## 1    115 92.971                                  
## 2    114 76.972  1    15.999 44.409 1.162e-09 ***
## 3    108 38.909  6    38.063 17.609 3.914e-14 ***
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1
</code></pre>

<h4>Activity</h4>

<ol>
<li>Recreate the following ANOVA table by fitting each model separately and using
the <code>anova()</code> function to recreate the models. </li>
</ol>

<p>Bonus: </p>

<ol>
<li>
why is Df only 5 for the interaction?</li>
</ol>

<pre><code class="r">m  &lt;- lm(Speed ~ Track*Starters, data = Sleuth3::ex0920)
anova(m)
</code></pre>

<pre><code>## Analysis of Variance Table
## 
## Response: Speed
##                 Df Sum Sq Mean Sq F value    Pr(&gt;F)    
## Track            6 46.122  7.6869 21.0717 5.382e-16 ***
## Starters         1  7.941  7.9408 21.7675 9.284e-06 ***
## Track:Starters   5  1.335  0.2669  0.7317    0.6013    
## Residuals      103 37.574  0.3648                      
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1
</code></pre>

<p><details><summary>Click for solution</summary> </p>

<p>We need to construct each model:</p>

<pre><code class="r">m0  &lt;- lm(Speed ~ 1, data = Sleuth3::ex0920)
mT  &lt;- lm(Speed ~ Track         , data = Sleuth3::ex0920)
mTS &lt;- lm(Speed ~ Track+Starters, data = Sleuth3::ex0920)
m   &lt;- lm(Speed ~ Track*Starters, data = Sleuth3::ex0920)
</code></pre>

<p>Then we use <code>anova()</code> to compare the models:</p>

<pre><code class="r">anova(m0, mT, mTS, m)
</code></pre>

<pre><code>## Analysis of Variance Table
## 
## Model 1: Speed ~ 1
## Model 2: Speed ~ Track
## Model 3: Speed ~ Track + Starters
## Model 4: Speed ~ Track * Starters
##   Res.Df    RSS Df Sum of Sq       F    Pr(&gt;F)    
## 1    115 92.971                                   
## 2    109 46.850  6    46.122 21.0717 5.382e-16 ***
## 3    108 38.909  1     7.941 21.7675 9.284e-06 ***
## 4    103 37.574  5     1.335  0.7317    0.6013    
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1
</code></pre>

<p></details></p>

<h3>Dropping one term</h3>

<p>The previous ANOVA table is often referred to as a sequential, or Type I, sum of
squares because the tests are sequential, e.g. </p>

<ol>
<li>should we add Track?</li>
<li>should we add Starters (in addition to Track)?</li>
<li>should we add the interaction between Track and Starters (in addition to 
Track and Starters)?</li>
</ol>

<p>Often times we are interested in whether terms should be dropped from the full
model. </p>

<p>In this situation, we always have a consistent full model and we are only 
considering dropping a particular explanatory variable. 
For example, consider the Kentucky Derby data with main effects for Track and 
Starters and we want to consider dropping Track or dropping Starters. </p>

<pre><code class="r">m &lt;- lm(Speed ~ Track + Starters, data = Sleuth3::ex0920)
drop1(m, test=&quot;F&quot;)
</code></pre>

<pre><code>## Single term deletions
## 
## Model:
## Speed ~ Track + Starters
##          Df Sum of Sq    RSS      AIC F value    Pr(&gt;F)    
## &lt;none&gt;                38.909 -110.714                      
## Track     6    38.063 76.972  -43.577  17.609 3.914e-14 ***
## Starters  1     7.941 46.850  -91.171  22.041 7.880e-06 ***
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1
</code></pre>

<p>Here the full model is the model with both Track and Starters. 
There is a different reduced model for each line:</p>

<ul>
<li>Track line has the reduced model that has no Track explanatory variable.</li>
<li>Starters line has the reduced model that has no Starters explanatory variable.</li>
</ul>

<p>So it is equivalent to the following two comparisons:</p>

<pre><code class="r">mT  &lt;- lm(Speed ~ Track,            data = Sleuth3::ex0920)
mS  &lt;- lm(Speed ~         Starters, data = Sleuth3::ex0920)
mST &lt;- lm(Speed ~ Track + Starters, data = Sleuth3::ex0920)
anova(mS,mST) # Consider adding Track into the model that already has Starters
</code></pre>

<pre><code>## Analysis of Variance Table
## 
## Model 1: Speed ~ Starters
## Model 2: Speed ~ Track + Starters
##   Res.Df    RSS Df Sum of Sq      F    Pr(&gt;F)    
## 1    114 76.972                                  
## 2    108 38.909  6    38.063 17.609 3.914e-14 ***
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1
</code></pre>

<pre><code class="r">anova(mT,mST) # Consider adding Starters into the model that already has Track
</code></pre>

<pre><code>## Analysis of Variance Table
## 
## Model 1: Speed ~ Track
## Model 2: Speed ~ Track + Starters
##   Res.Df    RSS Df Sum of Sq      F   Pr(&gt;F)    
## 1    109 46.850                                 
## 2    108 38.909  1    7.9408 22.041 7.88e-06 ***
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1
</code></pre>

<h4>Activity - Recreating ANOVA table</h4>

<p>Recreate the following <code>drop1()</code> results:</p>

<pre><code class="r">m &lt;- lm(Ingestion ~ Weight + Organic, data = Sleuth3::ex0921)
drop1(m, test=&#39;F&#39;)
</code></pre>

<pre><code>## Single term deletions
## 
## Model:
## Ingestion ~ Weight + Organic
##         Df Sum of Sq      RSS    AIC F value  Pr(&gt;F)  
## &lt;none&gt;               67301107 292.52                  
## Weight   1  29525368 96826475 297.44  7.0193 0.01749 *
## Organic  1   5833254 73134361 292.10  1.3868 0.25617  
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1
</code></pre>

<p><details><summary>Click for solution</summary>  </p>

<pre><code class="r">mW  &lt;- lm(Ingestion ~ Weight          , data = Sleuth3::ex0921)
mO  &lt;- lm(Ingestion ~          Organic, data = Sleuth3::ex0921)
mWO &lt;- lm(Ingestion ~ Weight + Organic, data = Sleuth3::ex0921)
anova(mO,mWO)
</code></pre>

<pre><code>## Analysis of Variance Table
## 
## Model 1: Ingestion ~ Organic
## Model 2: Ingestion ~ Weight + Organic
##   Res.Df      RSS Df Sum of Sq      F  Pr(&gt;F)  
## 1     17 96826475                              
## 2     16 67301107  1  29525368 7.0193 0.01749 *
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1
</code></pre>

<pre><code class="r">anova(mW,mWO)
</code></pre>

<pre><code>## Analysis of Variance Table
## 
## Model 1: Ingestion ~ Weight
## Model 2: Ingestion ~ Weight + Organic
##   Res.Df      RSS Df Sum of Sq      F Pr(&gt;F)
## 1     17 73134361                           
## 2     16 67301107  1   5833254 1.3868 0.2562
</code></pre>

<p></details></p>

<h3>Including interactions</h3>

<p>When interactions are considered, 
there is a <em>rule of thumb</em> that says that if an interaction is in the model, 
you should keep the main effects in the model. 
Thus, when you run drop1 on models with an interaction, 
it will only attempt to drop the interaction.</p>

<pre><code class="r">m &lt;- lm(Ingestion ~ Weight * Organic, data = Sleuth3::ex0921)
drop1(m, test = &#39;F&#39;)
</code></pre>

<pre><code>## Single term deletions
## 
## Model:
## Ingestion ~ Weight * Organic
##                Df Sum of Sq      RSS    AIC F value Pr(&gt;F)
## &lt;none&gt;                      61739502 292.89               
## Weight:Organic  1   5561605 67301107 292.52  1.3512 0.2632
</code></pre>

<h2>Model construction strategy</h2>

<p>When constructing a model, follow these prioritized rules</p>

<ol>
<li>Include explanatory variables that are part of the design</li>
<li>Include explanatory variables that answer questions of scientific interest</li>
<li>Include &ldquo;significant&#39;&#39; explanatory variables</li>
</ol>

<p>In particular, do NOT remove insignificant design variables. </p>

</body>

</html>

