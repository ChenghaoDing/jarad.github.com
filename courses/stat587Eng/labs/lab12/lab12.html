<!DOCTYPE html>
<!-- saved from url=(0014)about:internet -->
<html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8"/>
<meta http-equiv="x-ua-compatible" content="IE=9" >

<title>Preparation</title>

<style type="text/css">
body, td {
   font-family: sans-serif;
   background-color: white;
   font-size: 12px;
   margin: 8px;
}

tt, code, pre {
   font-family: 'DejaVu Sans Mono', 'Droid Sans Mono', 'Lucida Console', Consolas, Monaco, monospace;
}

h1 { 
   font-size:2.2em; 
}

h2 { 
   font-size:1.8em; 
}

h3 { 
   font-size:1.4em; 
}

h4 { 
   font-size:1.0em; 
}

h5 { 
   font-size:0.9em; 
}

h6 { 
   font-size:0.8em; 
}

a:visited {
   color: rgb(50%, 0%, 50%);
}

pre {	
   margin-top: 0;
   max-width: 95%;
   border: 1px solid #ccc;
   white-space: pre-wrap;
}

pre code {
   display: block; padding: 0.5em;
}

code.r, code.cpp {
   background-color: #F8F8F8;
}

table, td, th {
  border: none;
}

blockquote {
   color:#666666;
   margin:0;
   padding-left: 1em;
   border-left: 0.5em #EEE solid;
}

hr {
   height: 0px;
   border-bottom: none;
   border-top-width: thin;
   border-top-style: dotted;
   border-top-color: #999999;
}

@media print {
   * { 
      background: transparent !important; 
      color: black !important; 
      filter:none !important; 
      -ms-filter: none !important; 
   }

   body { 
      font-size:12pt; 
      max-width:100%; 
   }
       
   a, a:visited { 
      text-decoration: underline; 
   }

   hr { 
      visibility: hidden;
      page-break-before: always;
   }

   pre, blockquote { 
      padding-right: 1em; 
      page-break-inside: avoid; 
   }

   tr, img { 
      page-break-inside: avoid; 
   }

   img { 
      max-width: 100% !important; 
   }

   @page :left { 
      margin: 15mm 20mm 15mm 10mm; 
   }
     
   @page :right { 
      margin: 15mm 10mm 15mm 20mm; 
   }

   p, h2, h3 { 
      orphans: 3; widows: 3; 
   }

   h2, h3 { 
      page-break-after: avoid; 
   }
}

</style>

<!-- Styles for R syntax highlighter -->
<style type="text/css">
   pre .operator,
   pre .paren {
     color: rgb(104, 118, 135)
   }

   pre .literal {
     color: rgb(88, 72, 246)
   }

   pre .number {
     color: rgb(0, 0, 205);
   }

   pre .comment {
     color: rgb(76, 136, 107);
   }

   pre .keyword {
     color: rgb(0, 0, 255);
   }

   pre .identifier {
     color: rgb(0, 0, 0);
   }

   pre .string {
     color: rgb(3, 106, 7);
   }
</style>

<!-- R syntax highlighter -->
<script type="text/javascript">
var hljs=new function(){function m(p){return p.replace(/&/gm,"&amp;").replace(/</gm,"&lt;")}function f(r,q,p){return RegExp(q,"m"+(r.cI?"i":"")+(p?"g":""))}function b(r){for(var p=0;p<r.childNodes.length;p++){var q=r.childNodes[p];if(q.nodeName=="CODE"){return q}if(!(q.nodeType==3&&q.nodeValue.match(/\s+/))){break}}}function h(t,s){var p="";for(var r=0;r<t.childNodes.length;r++){if(t.childNodes[r].nodeType==3){var q=t.childNodes[r].nodeValue;if(s){q=q.replace(/\n/g,"")}p+=q}else{if(t.childNodes[r].nodeName=="BR"){p+="\n"}else{p+=h(t.childNodes[r])}}}if(/MSIE [678]/.test(navigator.userAgent)){p=p.replace(/\r/g,"\n")}return p}function a(s){var r=s.className.split(/\s+/);r=r.concat(s.parentNode.className.split(/\s+/));for(var q=0;q<r.length;q++){var p=r[q].replace(/^language-/,"");if(e[p]){return p}}}function c(q){var p=[];(function(s,t){for(var r=0;r<s.childNodes.length;r++){if(s.childNodes[r].nodeType==3){t+=s.childNodes[r].nodeValue.length}else{if(s.childNodes[r].nodeName=="BR"){t+=1}else{if(s.childNodes[r].nodeType==1){p.push({event:"start",offset:t,node:s.childNodes[r]});t=arguments.callee(s.childNodes[r],t);p.push({event:"stop",offset:t,node:s.childNodes[r]})}}}}return t})(q,0);return p}function k(y,w,x){var q=0;var z="";var s=[];function u(){if(y.length&&w.length){if(y[0].offset!=w[0].offset){return(y[0].offset<w[0].offset)?y:w}else{return w[0].event=="start"?y:w}}else{return y.length?y:w}}function t(D){var A="<"+D.nodeName.toLowerCase();for(var B=0;B<D.attributes.length;B++){var C=D.attributes[B];A+=" "+C.nodeName.toLowerCase();if(C.value!==undefined&&C.value!==false&&C.value!==null){A+='="'+m(C.value)+'"'}}return A+">"}while(y.length||w.length){var v=u().splice(0,1)[0];z+=m(x.substr(q,v.offset-q));q=v.offset;if(v.event=="start"){z+=t(v.node);s.push(v.node)}else{if(v.event=="stop"){var p,r=s.length;do{r--;p=s[r];z+=("</"+p.nodeName.toLowerCase()+">")}while(p!=v.node);s.splice(r,1);while(r<s.length){z+=t(s[r]);r++}}}}return z+m(x.substr(q))}function j(){function q(x,y,v){if(x.compiled){return}var u;var s=[];if(x.k){x.lR=f(y,x.l||hljs.IR,true);for(var w in x.k){if(!x.k.hasOwnProperty(w)){continue}if(x.k[w] instanceof Object){u=x.k[w]}else{u=x.k;w="keyword"}for(var r in u){if(!u.hasOwnProperty(r)){continue}x.k[r]=[w,u[r]];s.push(r)}}}if(!v){if(x.bWK){x.b="\\b("+s.join("|")+")\\s"}x.bR=f(y,x.b?x.b:"\\B|\\b");if(!x.e&&!x.eW){x.e="\\B|\\b"}if(x.e){x.eR=f(y,x.e)}}if(x.i){x.iR=f(y,x.i)}if(x.r===undefined){x.r=1}if(!x.c){x.c=[]}x.compiled=true;for(var t=0;t<x.c.length;t++){if(x.c[t]=="self"){x.c[t]=x}q(x.c[t],y,false)}if(x.starts){q(x.starts,y,false)}}for(var p in e){if(!e.hasOwnProperty(p)){continue}q(e[p].dM,e[p],true)}}function d(B,C){if(!j.called){j();j.called=true}function q(r,M){for(var L=0;L<M.c.length;L++){if((M.c[L].bR.exec(r)||[null])[0]==r){return M.c[L]}}}function v(L,r){if(D[L].e&&D[L].eR.test(r)){return 1}if(D[L].eW){var M=v(L-1,r);return M?M+1:0}return 0}function w(r,L){return L.i&&L.iR.test(r)}function K(N,O){var M=[];for(var L=0;L<N.c.length;L++){M.push(N.c[L].b)}var r=D.length-1;do{if(D[r].e){M.push(D[r].e)}r--}while(D[r+1].eW);if(N.i){M.push(N.i)}return f(O,M.join("|"),true)}function p(M,L){var N=D[D.length-1];if(!N.t){N.t=K(N,E)}N.t.lastIndex=L;var r=N.t.exec(M);return r?[M.substr(L,r.index-L),r[0],false]:[M.substr(L),"",true]}function z(N,r){var L=E.cI?r[0].toLowerCase():r[0];var M=N.k[L];if(M&&M instanceof Array){return M}return false}function F(L,P){L=m(L);if(!P.k){return L}var r="";var O=0;P.lR.lastIndex=0;var M=P.lR.exec(L);while(M){r+=L.substr(O,M.index-O);var N=z(P,M);if(N){x+=N[1];r+='<span class="'+N[0]+'">'+M[0]+"</span>"}else{r+=M[0]}O=P.lR.lastIndex;M=P.lR.exec(L)}return r+L.substr(O,L.length-O)}function J(L,M){if(M.sL&&e[M.sL]){var r=d(M.sL,L);x+=r.keyword_count;return r.value}else{return F(L,M)}}function I(M,r){var L=M.cN?'<span class="'+M.cN+'">':"";if(M.rB){y+=L;M.buffer=""}else{if(M.eB){y+=m(r)+L;M.buffer=""}else{y+=L;M.buffer=r}}D.push(M);A+=M.r}function G(N,M,Q){var R=D[D.length-1];if(Q){y+=J(R.buffer+N,R);return false}var P=q(M,R);if(P){y+=J(R.buffer+N,R);I(P,M);return P.rB}var L=v(D.length-1,M);if(L){var O=R.cN?"</span>":"";if(R.rE){y+=J(R.buffer+N,R)+O}else{if(R.eE){y+=J(R.buffer+N,R)+O+m(M)}else{y+=J(R.buffer+N+M,R)+O}}while(L>1){O=D[D.length-2].cN?"</span>":"";y+=O;L--;D.length--}var r=D[D.length-1];D.length--;D[D.length-1].buffer="";if(r.starts){I(r.starts,"")}return R.rE}if(w(M,R)){throw"Illegal"}}var E=e[B];var D=[E.dM];var A=0;var x=0;var y="";try{var s,u=0;E.dM.buffer="";do{s=p(C,u);var t=G(s[0],s[1],s[2]);u+=s[0].length;if(!t){u+=s[1].length}}while(!s[2]);if(D.length>1){throw"Illegal"}return{r:A,keyword_count:x,value:y}}catch(H){if(H=="Illegal"){return{r:0,keyword_count:0,value:m(C)}}else{throw H}}}function g(t){var p={keyword_count:0,r:0,value:m(t)};var r=p;for(var q in e){if(!e.hasOwnProperty(q)){continue}var s=d(q,t);s.language=q;if(s.keyword_count+s.r>r.keyword_count+r.r){r=s}if(s.keyword_count+s.r>p.keyword_count+p.r){r=p;p=s}}if(r.language){p.second_best=r}return p}function i(r,q,p){if(q){r=r.replace(/^((<[^>]+>|\t)+)/gm,function(t,w,v,u){return w.replace(/\t/g,q)})}if(p){r=r.replace(/\n/g,"<br>")}return r}function n(t,w,r){var x=h(t,r);var v=a(t);var y,s;if(v){y=d(v,x)}else{return}var q=c(t);if(q.length){s=document.createElement("pre");s.innerHTML=y.value;y.value=k(q,c(s),x)}y.value=i(y.value,w,r);var u=t.className;if(!u.match("(\\s|^)(language-)?"+v+"(\\s|$)")){u=u?(u+" "+v):v}if(/MSIE [678]/.test(navigator.userAgent)&&t.tagName=="CODE"&&t.parentNode.tagName=="PRE"){s=t.parentNode;var p=document.createElement("div");p.innerHTML="<pre><code>"+y.value+"</code></pre>";t=p.firstChild.firstChild;p.firstChild.cN=s.cN;s.parentNode.replaceChild(p.firstChild,s)}else{t.innerHTML=y.value}t.className=u;t.result={language:v,kw:y.keyword_count,re:y.r};if(y.second_best){t.second_best={language:y.second_best.language,kw:y.second_best.keyword_count,re:y.second_best.r}}}function o(){if(o.called){return}o.called=true;var r=document.getElementsByTagName("pre");for(var p=0;p<r.length;p++){var q=b(r[p]);if(q){n(q,hljs.tabReplace)}}}function l(){if(window.addEventListener){window.addEventListener("DOMContentLoaded",o,false);window.addEventListener("load",o,false)}else{if(window.attachEvent){window.attachEvent("onload",o)}else{window.onload=o}}}var e={};this.LANGUAGES=e;this.highlight=d;this.highlightAuto=g;this.fixMarkup=i;this.highlightBlock=n;this.initHighlighting=o;this.initHighlightingOnLoad=l;this.IR="[a-zA-Z][a-zA-Z0-9_]*";this.UIR="[a-zA-Z_][a-zA-Z0-9_]*";this.NR="\\b\\d+(\\.\\d+)?";this.CNR="\\b(0[xX][a-fA-F0-9]+|(\\d+(\\.\\d*)?|\\.\\d+)([eE][-+]?\\d+)?)";this.BNR="\\b(0b[01]+)";this.RSR="!|!=|!==|%|%=|&|&&|&=|\\*|\\*=|\\+|\\+=|,|\\.|-|-=|/|/=|:|;|<|<<|<<=|<=|=|==|===|>|>=|>>|>>=|>>>|>>>=|\\?|\\[|\\{|\\(|\\^|\\^=|\\||\\|=|\\|\\||~";this.ER="(?![\\s\\S])";this.BE={b:"\\\\.",r:0};this.ASM={cN:"string",b:"'",e:"'",i:"\\n",c:[this.BE],r:0};this.QSM={cN:"string",b:'"',e:'"',i:"\\n",c:[this.BE],r:0};this.CLCM={cN:"comment",b:"//",e:"$"};this.CBLCLM={cN:"comment",b:"/\\*",e:"\\*/"};this.HCM={cN:"comment",b:"#",e:"$"};this.NM={cN:"number",b:this.NR,r:0};this.CNM={cN:"number",b:this.CNR,r:0};this.BNM={cN:"number",b:this.BNR,r:0};this.inherit=function(r,s){var p={};for(var q in r){p[q]=r[q]}if(s){for(var q in s){p[q]=s[q]}}return p}}();hljs.LANGUAGES.cpp=function(){var a={keyword:{"false":1,"int":1,"float":1,"while":1,"private":1,"char":1,"catch":1,"export":1,virtual:1,operator:2,sizeof:2,dynamic_cast:2,typedef:2,const_cast:2,"const":1,struct:1,"for":1,static_cast:2,union:1,namespace:1,unsigned:1,"long":1,"throw":1,"volatile":2,"static":1,"protected":1,bool:1,template:1,mutable:1,"if":1,"public":1,friend:2,"do":1,"return":1,"goto":1,auto:1,"void":2,"enum":1,"else":1,"break":1,"new":1,extern:1,using:1,"true":1,"class":1,asm:1,"case":1,typeid:1,"short":1,reinterpret_cast:2,"default":1,"double":1,register:1,explicit:1,signed:1,typename:1,"try":1,"this":1,"switch":1,"continue":1,wchar_t:1,inline:1,"delete":1,alignof:1,char16_t:1,char32_t:1,constexpr:1,decltype:1,noexcept:1,nullptr:1,static_assert:1,thread_local:1,restrict:1,_Bool:1,complex:1},built_in:{std:1,string:1,cin:1,cout:1,cerr:1,clog:1,stringstream:1,istringstream:1,ostringstream:1,auto_ptr:1,deque:1,list:1,queue:1,stack:1,vector:1,map:1,set:1,bitset:1,multiset:1,multimap:1,unordered_set:1,unordered_map:1,unordered_multiset:1,unordered_multimap:1,array:1,shared_ptr:1}};return{dM:{k:a,i:"</",c:[hljs.CLCM,hljs.CBLCLM,hljs.QSM,{cN:"string",b:"'\\\\?.",e:"'",i:"."},{cN:"number",b:"\\b(\\d+(\\.\\d*)?|\\.\\d+)(u|U|l|L|ul|UL|f|F)"},hljs.CNM,{cN:"preprocessor",b:"#",e:"$"},{cN:"stl_container",b:"\\b(deque|list|queue|stack|vector|map|set|bitset|multiset|multimap|unordered_map|unordered_set|unordered_multiset|unordered_multimap|array)\\s*<",e:">",k:a,r:10,c:["self"]}]}}}();hljs.LANGUAGES.r={dM:{c:[hljs.HCM,{cN:"number",b:"\\b0[xX][0-9a-fA-F]+[Li]?\\b",e:hljs.IMMEDIATE_RE,r:0},{cN:"number",b:"\\b\\d+(?:[eE][+\\-]?\\d*)?L\\b",e:hljs.IMMEDIATE_RE,r:0},{cN:"number",b:"\\b\\d+\\.(?!\\d)(?:i\\b)?",e:hljs.IMMEDIATE_RE,r:1},{cN:"number",b:"\\b\\d+(?:\\.\\d*)?(?:[eE][+\\-]?\\d*)?i?\\b",e:hljs.IMMEDIATE_RE,r:0},{cN:"number",b:"\\.\\d+(?:[eE][+\\-]?\\d*)?i?\\b",e:hljs.IMMEDIATE_RE,r:1},{cN:"keyword",b:"(?:tryCatch|library|setGeneric|setGroupGeneric)\\b",e:hljs.IMMEDIATE_RE,r:10},{cN:"keyword",b:"\\.\\.\\.",e:hljs.IMMEDIATE_RE,r:10},{cN:"keyword",b:"\\.\\.\\d+(?![\\w.])",e:hljs.IMMEDIATE_RE,r:10},{cN:"keyword",b:"\\b(?:function)",e:hljs.IMMEDIATE_RE,r:2},{cN:"keyword",b:"(?:if|in|break|next|repeat|else|for|return|switch|while|try|stop|warning|require|attach|detach|source|setMethod|setClass)\\b",e:hljs.IMMEDIATE_RE,r:1},{cN:"literal",b:"(?:NA|NA_integer_|NA_real_|NA_character_|NA_complex_)\\b",e:hljs.IMMEDIATE_RE,r:10},{cN:"literal",b:"(?:NULL|TRUE|FALSE|T|F|Inf|NaN)\\b",e:hljs.IMMEDIATE_RE,r:1},{cN:"identifier",b:"[a-zA-Z.][a-zA-Z0-9._]*\\b",e:hljs.IMMEDIATE_RE,r:0},{cN:"operator",b:"<\\-(?!\\s*\\d)",e:hljs.IMMEDIATE_RE,r:2},{cN:"operator",b:"\\->|<\\-",e:hljs.IMMEDIATE_RE,r:1},{cN:"operator",b:"%%|~",e:hljs.IMMEDIATE_RE},{cN:"operator",b:">=|<=|==|!=|\\|\\||&&|=|\\+|\\-|\\*|/|\\^|>|<|!|&|\\||\\$|:",e:hljs.IMMEDIATE_RE,r:0},{cN:"operator",b:"%",e:"%",i:"\\n",r:1},{cN:"identifier",b:"`",e:"`",r:0},{cN:"string",b:'"',e:'"',c:[hljs.BE],r:0},{cN:"string",b:"'",e:"'",c:[hljs.BE],r:0},{cN:"paren",b:"[[({\\])}]",e:hljs.IMMEDIATE_RE,r:0}]}};
hljs.initHighlightingOnLoad();
</script>




</head>

<body>
<h2>Preparation</h2>

<p>To follow along, use the <a href="lab12.R">lab12 code</a> and make sure the following 
packag is installed:</p>

<ul>
<li>lme4</li>
</ul>

<p>You can use the following code to perform the installation:</p>

<pre><code class="r">install.packages(&quot;lme4&quot;)
</code></pre>

<p>Now load the packages</p>

<pre><code class="r">library(&quot;dplyr&quot;)
</code></pre>

<pre><code>## 
## Attaching package: &#39;dplyr&#39;
</code></pre>

<pre><code>## The following objects are masked from &#39;package:stats&#39;:
## 
##     filter, lag
</code></pre>

<pre><code>## The following objects are masked from &#39;package:base&#39;:
## 
##     intersect, setdiff, setequal, union
</code></pre>

<pre><code class="r">library(&quot;ggplot2&quot;)
# library(&quot;Sleuth3&quot;)
library(&quot;lme4&quot;)
</code></pre>

<pre><code>## Loading required package: Matrix
</code></pre>

<h2>Generalized linear models</h2>

<p>[Generalized linear models] are a class of models that include </p>

<ul>
<li>linear regression</li>
<li>logistic regression</li>
<li>Poisson regression</li>
</ul>

<p>as specific examples.
The <code>glm()</code> function allows us to fit all of these models, 
although we usually use the <code>lm()</code> function for the special (and important)
case of linear regression.</p>

<h3>Linear regression</h3>

<p>The linear regression model can be fit using either the <code>glm()</code> or <code>lm()</code> 
function, 
but running <code>summary()</code> on the <code>lm()</code> function analysis is more informative.</p>

<pre><code class="r">m_lm  &lt;- lm( Velocity ~ Distance, data = Sleuth3::case0701)
m_glm &lt;- glm(Velocity ~ Distance, data = Sleuth3::case0701)
</code></pre>

<p>where the default family in the <code>glm()</code> function is <code>normal</code>.</p>

<pre><code class="r">summary(m_lm)
</code></pre>

<pre><code>## 
## Call:
## lm(formula = Velocity ~ Distance, data = Sleuth3::case0701)
## 
## Residuals:
##     Min      1Q  Median      3Q     Max 
## -398.02 -157.03  -12.88  148.14  506.61 
## 
## Coefficients:
##             Estimate Std. Error t value Pr(&gt;|t|)    
## (Intercept)   -40.25      83.52  -0.482    0.635    
## Distance      453.63      75.30   6.024 4.61e-06 ***
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1
## 
## Residual standard error: 233.2 on 22 degrees of freedom
## Multiple R-squared:  0.6226, Adjusted R-squared:  0.6054 
## F-statistic: 36.29 on 1 and 22 DF,  p-value: 4.608e-06
</code></pre>

<pre><code class="r">summary(m_glm)
</code></pre>

<pre><code>## 
## Call:
## glm(formula = Velocity ~ Distance, data = Sleuth3::case0701)
## 
## Deviance Residuals: 
##     Min       1Q   Median       3Q      Max  
## -398.02  -157.03   -12.88   148.14   506.61  
## 
## Coefficients:
##             Estimate Std. Error t value Pr(&gt;|t|)    
## (Intercept)   -40.25      83.52  -0.482    0.635    
## Distance      453.63      75.30   6.024 4.61e-06 ***
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1
## 
## (Dispersion parameter for gaussian family taken to be 54385.57)
## 
##     Null deviance: 3170091  on 23  degrees of freedom
## Residual deviance: 1196482  on 22  degrees of freedom
## AIC: 333.71
## 
## Number of Fisher Scoring iterations: 2
</code></pre>

<p>The dispersion parameter is the estimate of the variance.</p>

<h3>Logistic regression</h3>

<p>Logistic regression can be accomplished using the <code>glm()</code> function and 
setting the <code>family</code> argument to <code>binomial</code>. 
There are two different ways to set up the logistic regression model fit 
depending on whether the data are grouped or not.</p>

<h4>Ungrouped data</h4>

<p>For ungrouped data, the response can be a factor where the first level is 
failure and all other levels are success.</p>

<pre><code class="r">levels(Sleuth3::case2002$LC)
</code></pre>

<pre><code>## [1] &quot;LungCancer&quot; &quot;NoCancer&quot;
</code></pre>

<pre><code class="r">m &lt;- glm(LC ~ CD, data = Sleuth3::case2002, family=binomial)
m
</code></pre>

<pre><code>## 
## Call:  glm(formula = LC ~ CD, family = binomial, data = Sleuth3::case2002)
## 
## Coefficients:
## (Intercept)           CD  
##     1.53541     -0.05113  
## 
## Degrees of Freedom: 146 Total (i.e. Null);  145 Residual
## Null Deviance:       187.1 
## Residual Deviance: 179.6     AIC: 183.6
</code></pre>

<p>Thus, this logistic regression analysis has <code>success&#39;&#39; being</code>NoCancer&#39;&#39;. </p>

<p>It is better practice to be explicit. 
You can be explicit by using an equality and thus treating the response as 
TRUE/FALSE.</p>

<pre><code class="r">m &lt;- glm(LC == &quot;LungCancer&quot; ~ CD, 
         data = Sleuth3::case2002, 
         family = binomial)
m
</code></pre>

<pre><code>## 
## Call:  glm(formula = LC == &quot;LungCancer&quot; ~ CD, family = binomial, data = Sleuth3::case2002)
## 
## Coefficients:
## (Intercept)           CD  
##    -1.53541      0.05113  
## 
## Degrees of Freedom: 146 Total (i.e. Null);  145 Residual
## Null Deviance:       187.1 
## Residual Deviance: 179.6     AIC: 183.6
</code></pre>

<p>Care needs to be taken with this approach because any value other than 
&ldquo;LungCancer&#39;&#39; will be treated as a failure, e.g. typos. </p>

<p>Finally, we can use a 0-1 coding where 1 is a success and 0 is failure.</p>

<pre><code class="r">d &lt;- Sleuth3::case2002 %&gt;%
  mutate(lung_cancer = 1*(LC == &quot;LungCancer&quot;))
m &lt;- glm(LC == &quot;LungCancer&quot; ~ CD, 
         data = d, 
         family = binomial)
m
</code></pre>

<pre><code>## 
## Call:  glm(formula = LC == &quot;LungCancer&quot; ~ CD, family = binomial, data = d)
## 
## Coefficients:
## (Intercept)           CD  
##    -1.53541      0.05113  
## 
## Degrees of Freedom: 146 Total (i.e. Null);  145 Residual
## Null Deviance:       187.1 
## Residual Deviance: 179.6     AIC: 183.6
</code></pre>

<p>To obtain a better summary use <code>summary</code>(). </p>

<pre><code class="r">summary(m)
</code></pre>

<pre><code>## 
## Call:
## glm(formula = LC == &quot;LungCancer&quot; ~ CD, family = binomial, data = d)
## 
## Deviance Residuals: 
##     Min       1Q   Median       3Q      Max  
## -1.5148  -0.9688  -0.7166   1.3449   1.8603  
## 
## Coefficients:
##             Estimate Std. Error z value Pr(&gt;|z|)    
## (Intercept) -1.53541    0.37707  -4.072 4.66e-05 ***
## CD           0.05113    0.01939   2.637  0.00836 ** 
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1
## 
## (Dispersion parameter for binomial family taken to be 1)
## 
##     Null deviance: 187.14  on 146  degrees of freedom
## Residual deviance: 179.62  on 145  degrees of freedom
## AIC: 183.62
## 
## Number of Fisher Scoring iterations: 4
</code></pre>

<h4>Activity</h4>

<p>Fit a logistic regression model to determine the relationship between survival
in the Donner Party (<code>case2001</code>) and the age and sex of the individual. </p>

<p><details><summary>Click for solution</summary>  </p>

<pre><code class="r">m &lt;- glm(Status == &quot;Survived&quot; ~ Age + Sex,
         data = Sleuth3::case2001,
         family = binomial)
summary(m)
</code></pre>

<pre><code>## 
## Call:
## glm(formula = Status == &quot;Survived&quot; ~ Age + Sex, family = binomial, 
##     data = Sleuth3::case2001)
## 
## Deviance Residuals: 
##     Min       1Q   Median       3Q      Max  
## -1.7445  -1.0441  -0.3029   0.8877   2.0472  
## 
## Coefficients:
##             Estimate Std. Error z value Pr(&gt;|z|)  
## (Intercept)  3.23041    1.38686   2.329   0.0198 *
## Age         -0.07820    0.03728  -2.097   0.0359 *
## SexMale     -1.59729    0.75547  -2.114   0.0345 *
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1
## 
## (Dispersion parameter for binomial family taken to be 1)
## 
##     Null deviance: 61.827  on 44  degrees of freedom
## Residual deviance: 51.256  on 42  degrees of freedom
## AIC: 57.256
## 
## Number of Fisher Scoring iterations: 4
</code></pre>

<p></details></p>

<h3>Grouped data</h3>

<p>Often times data are grouped by explanatory variable values.
For example, we can group the lung cancer data set by the number of cigarettes
per day.
The most typical way these data are stored is to have the number of observations
and the proportion of them that were successful&#39;&#39;. </p>

<pre><code class="r">lung_grouped &lt;- Sleuth3::case2002 %&gt;%
  group_by(CD) %&gt;%
  summarize(n = n(),
            y = sum(LC == &quot;LungCancer&quot;))
</code></pre>

<pre><code>## `summarise()` ungrouping output (override with `.groups` argument)
</code></pre>

<pre><code class="r">lung_grouped
</code></pre>

<pre><code>## # A tibble: 19 x 3
##       CD     n     y
##    &lt;int&gt; &lt;int&gt; &lt;int&gt;
##  1     0    17     1
##  2     1     2     0
##  3     2     2     0
##  4     3     1     1
##  5     4     2     0
##  6     5     2     0
##  7     6     3     1
##  8     8     2     0
##  9    10    15     4
## 10    12     5     1
## 11    15    27    12
## 12    16     1     1
## 13    18     2     0
## 14    20    38    16
## 15    25    15     7
## 16    30     7     3
## 17    37     1     0
## 18    40     4     2
## 19    45     1     0
</code></pre>

<p>You can still fit the regression model using the <code>glm()</code> function, but you 
need to using the <code>cbind()</code> function as the response where you have the first
term is the number of successes and the second term is the number of failures.
So the logistic regression model fit looks like.
(Be careful not to use the <code>c()</code> function or you will get a variable 
lengths differ&#39;&#39; error.)</p>

<pre><code class="r">m &lt;- glm(cbind(y,n-y) ~ CD, 
         data = lung_grouped, 
         family = binomial)
summary(m)
</code></pre>

<pre><code>## 
## Call:
## glm(formula = cbind(y, n - y) ~ CD, family = binomial, data = lung_grouped)
## 
## Deviance Residuals: 
##     Min       1Q   Median       3Q      Max  
## -1.5148  -1.0253  -0.5070   0.3305   1.7922  
## 
## Coefficients:
##             Estimate Std. Error z value Pr(&gt;|z|)    
## (Intercept) -1.53541    0.37707  -4.072 4.66e-05 ***
## CD           0.05113    0.01939   2.637  0.00836 ** 
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1
## 
## (Dispersion parameter for binomial family taken to be 1)
## 
##     Null deviance: 28.651  on 18  degrees of freedom
## Residual deviance: 21.141  on 17  degrees of freedom
## AIC: 48.879
## 
## Number of Fisher Scoring iterations: 4
</code></pre>

<h4>Activity</h4>

<p>Group the Donner party data (<code>Sleuth3::case2001</code>) by age and sex. 
Then re-run the logistic regression analysis from the previous activity on 
these grouped data.</p>

<p><details><summary>Click for solution</summary>  </p>

<pre><code class="r">donner_grouped &lt;- Sleuth3::case2001 %&gt;%
  group_by(Age,Sex) %&gt;%
  summarize(y = sum(Status == &quot;Survived&quot;),
         n = n())
</code></pre>

<pre><code>## `summarise()` regrouping output by &#39;Age&#39; (override with `.groups` argument)
</code></pre>

<pre><code class="r">m &lt;- glm(cbind(y,n-y) ~ Age + Sex,
         data = donner_grouped,
         family = binomial)

summary(m)
</code></pre>

<pre><code>## 
## Call:
## glm(formula = cbind(y, n - y) ~ Age + Sex, family = binomial, 
##     data = donner_grouped)
## 
## Deviance Residuals: 
##     Min       1Q   Median       3Q      Max  
## -1.4955  -0.7860   0.1202   0.7618   2.0472  
## 
## Coefficients:
##             Estimate Std. Error z value Pr(&gt;|z|)  
## (Intercept)  3.23041    1.38697   2.329   0.0199 *
## Age         -0.07820    0.03729  -2.097   0.0360 *
## SexMale     -1.59729    0.75550  -2.114   0.0345 *
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1
## 
## (Dispersion parameter for binomial family taken to be 1)
## 
##     Null deviance: 37.012  on 27  degrees of freedom
## Residual deviance: 26.441  on 25  degrees of freedom
## AIC: 42.347
## 
## Number of Fisher Scoring iterations: 5
</code></pre>

<p></details></p>

<h3>Poisson regression</h3>

<p>To run a Poisson regression in R, use the <code>glm()</code> function with the <code>family</code> 
argument set to <code>poisson</code>. </p>

<pre><code class="r">m &lt;- glm(Matings ~ Age,
         data = Sleuth3::case2201,
         family = poisson)
summary(m)
</code></pre>

<pre><code>## 
## Call:
## glm(formula = Matings ~ Age, family = poisson, data = Sleuth3::case2201)
## 
## Deviance Residuals: 
##      Min        1Q    Median        3Q       Max  
## -2.80798  -0.86137  -0.08629   0.60087   2.17777  
## 
## Coefficients:
##             Estimate Std. Error z value Pr(&gt;|z|)    
## (Intercept) -1.58201    0.54462  -2.905  0.00368 ** 
## Age          0.06869    0.01375   4.997 5.81e-07 ***
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1
## 
## (Dispersion parameter for poisson family taken to be 1)
## 
##     Null deviance: 75.372  on 40  degrees of freedom
## Residual deviance: 51.012  on 39  degrees of freedom
## AIC: 156.46
## 
## Number of Fisher Scoring iterations: 5
</code></pre>

<h4>Activity</h4>

<p>Investigate the relationship between number of salamanders as a function of 
forest age using a Poisson regression analysis. 
Data are available in Sleuth3::case2202&#39;. </p>

<p><details><summary>Click for solution</summary> </p>

<pre><code class="r">m &lt;- glm(Salamanders ~ ForestAge, 
         data = Sleuth3::case2202,
         family = poisson)

summary(m)
</code></pre>

<pre><code>## 
## Call:
## glm(formula = Salamanders ~ ForestAge, family = poisson, data = Sleuth3::case2202)
## 
## Deviance Residuals: 
##     Min       1Q   Median       3Q      Max  
## -2.6970  -1.8539  -0.7987   0.2144   4.4582  
## 
## Coefficients:
##              Estimate Std. Error z value Pr(&gt;|z|)    
## (Intercept) 0.5040207  0.1401385   3.597 0.000322 ***
## ForestAge   0.0019151  0.0004155   4.609 4.05e-06 ***
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1
## 
## (Dispersion parameter for poisson family taken to be 1)
## 
##     Null deviance: 190.22  on 46  degrees of freedom
## Residual deviance: 170.65  on 45  degrees of freedom
## AIC: 259.7
## 
## Number of Fisher Scoring iterations: 6
</code></pre>

<p></details></p>

<h2>Comparing generalized linear models</h2>

<p>To compare nested linear models, we used the F-test through the R function
<code>anova()</code>. 
For GLMs, we will use a likelihood ratio test through the same function.
Asymptotically (i.e. as you have infinite data), the statistic for this test 
has a chi-squared distribution. 
Thus, we specify this test using the <code>anova()</code> table setting the <code>test</code> argument
to &quot;Chi&rdquo;. </p>

<p>Here is a test to determine whether we should have included an interaction 
between birdkeeping and the number of cigarettes per day.</p>

<pre><code class="r">mA &lt;- glm(LC ~ BK + CD, data = Sleuth3::case2002, family = binomial)
mI &lt;- glm(LC ~ BK * CD, data = Sleuth3::case2002, family = binomial)
anova(mA,mI, test=&quot;Chi&quot;)
</code></pre>

<pre><code>## Analysis of Deviance Table
## 
## Model 1: LC ~ BK + CD
## Model 2: LC ~ BK * CD
##   Resid. Df Resid. Dev Df  Deviance Pr(&gt;Chi)
## 1       144     164.36                      
## 2       143     164.35  1 0.0068661    0.934
</code></pre>

<p>Note that the title of this table is &ldquo;Analysis of Deviance&rdquo; which indicates
you are working with GLMs rather than linear models.</p>

<h4>Activity</h4>

<p>Use a likelihood ratio test to determine whether an interaction between Age and
Sex should be included in the logistic regression model of survival probability
in the Donner party.</p>

<p><details><summary>Click for solution</summary>  </p>

<pre><code class="r">mA &lt;- glm(Status ~ Age + Sex, data = Sleuth3::case2001, family = binomial)
mI &lt;- glm(Status ~ Age * Sex, data = Sleuth3::case2001, family = binomial)
anova(mA,mI, test=&quot;Chi&quot;)
</code></pre>

<pre><code>## Analysis of Deviance Table
## 
## Model 1: Status ~ Age + Sex
## Model 2: Status ~ Age * Sex
##   Resid. Df Resid. Dev Df Deviance Pr(&gt;Chi)  
## 1        42     51.256                       
## 2        41     47.346  1   3.9099    0.048 *
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1
</code></pre>

<p></details></p>

<h2>Generalized linear mixed effect models</h2>

<p>To fit a mixed effect model in R, use the 
<a href="https://cran.r-project.org/web/packages/lme4/index.html">lme4 package</a>.</p>

<h3>Linear mixed effect models</h3>

<p>For a linear regression model with random effects, 
use the <code>lmer</code>() function.</p>

<p>Here is a random intercept model.</p>

<pre><code class="r">library(&quot;lme4&quot;)
m &lt;- lmer(Reaction ~ Days + (1| Subject), data = sleepstudy)
summary(m)
</code></pre>

<pre><code>## Linear mixed model fit by REML [&#39;lmerMod&#39;]
## Formula: Reaction ~ Days + (1 | Subject)
##    Data: sleepstudy
## 
## REML criterion at convergence: 1786.5
## 
## Scaled residuals: 
##     Min      1Q  Median      3Q     Max 
## -3.2257 -0.5529  0.0109  0.5188  4.2506 
## 
## Random effects:
##  Groups   Name        Variance Std.Dev.
##  Subject  (Intercept) 1378.2   37.12   
##  Residual              960.5   30.99   
## Number of obs: 180, groups:  Subject, 18
## 
## Fixed effects:
##             Estimate Std. Error t value
## (Intercept) 251.4051     9.7467   25.79
## Days         10.4673     0.8042   13.02
## 
## Correlation of Fixed Effects:
##      (Intr)
## Days -0.371
</code></pre>

<p>Here is a random slope model</p>

<pre><code class="r">m &lt;- lmer(Reaction ~ Days + (Days| Subject), data = sleepstudy)
summary(m)
</code></pre>

<pre><code>## Linear mixed model fit by REML [&#39;lmerMod&#39;]
## Formula: Reaction ~ Days + (Days | Subject)
##    Data: sleepstudy
## 
## REML criterion at convergence: 1743.6
## 
## Scaled residuals: 
##     Min      1Q  Median      3Q     Max 
## -3.9536 -0.4634  0.0231  0.4634  5.1793 
## 
## Random effects:
##  Groups   Name        Variance Std.Dev. Corr
##  Subject  (Intercept) 612.10   24.741       
##           Days         35.07    5.922   0.07
##  Residual             654.94   25.592       
## Number of obs: 180, groups:  Subject, 18
## 
## Fixed effects:
##             Estimate Std. Error t value
## (Intercept)  251.405      6.825  36.838
## Days          10.467      1.546   6.771
## 
## Correlation of Fixed Effects:
##      (Intr)
## Days -0.138
</code></pre>

<h3>Generalized linear mixed effect models</h3>

<p>For any generalized linear model, e.g. logistic and Poisson regression,
you can add random effects using the <code>glmer()</code> function.</p>

<p>Random intercept model.</p>

<pre><code class="r">m &lt;- glmer(cbind(incidence, size - incidence) ~ period + (1 | herd),
              data = cbpp, family = binomial)
summary(m)
</code></pre>

<pre><code>## Generalized linear mixed model fit by maximum likelihood (Laplace
##   Approximation) [glmerMod]
##  Family: binomial  ( logit )
## Formula: cbind(incidence, size - incidence) ~ period + (1 | herd)
##    Data: cbpp
## 
##      AIC      BIC   logLik deviance df.resid 
##    194.1    204.2    -92.0    184.1       51 
## 
## Scaled residuals: 
##     Min      1Q  Median      3Q     Max 
## -2.3816 -0.7889 -0.2026  0.5142  2.8791 
## 
## Random effects:
##  Groups Name        Variance Std.Dev.
##  herd   (Intercept) 0.4123   0.6421  
## Number of obs: 56, groups:  herd, 15
## 
## Fixed effects:
##             Estimate Std. Error z value Pr(&gt;|z|)    
## (Intercept)  -1.3983     0.2312  -6.048 1.47e-09 ***
## period2      -0.9919     0.3032  -3.272 0.001068 ** 
## period3      -1.1282     0.3228  -3.495 0.000474 ***
## period4      -1.5797     0.4220  -3.743 0.000182 ***
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1
## 
## Correlation of Fixed Effects:
##         (Intr) perid2 perid3
## period2 -0.363              
## period3 -0.340  0.280       
## period4 -0.260  0.213  0.198
</code></pre>

</body>

</html>

