---
title: "Lab08 - Categorical explanatory variables"
author: "Jarad Niemi"
date: "`r Sys.Date()`"
output: html_document
---


To follow along, use the [lab08 code](lab08.R) and make sure the following 
packages are installed:

- Sleuth3
- readr

You can use the following code to perform the installation:

```{r install_packages, eval=FALSE}
install.packages(c("Sleuth3","readr"))
```

Now load the packages

```{r load_packages}
library("dplyr")
library("ggplot2")
library("Sleuth3")
```

## Overview

Categorical variables in R are represented either by a 

- character
- factor

A factor is a special character variable that 

- has an underlying numerical representation,
- a lookup table to find the values, and
- an inherent ordering.

When using characters are factors in a regression model in R, 
the character will automatically be converted to a factor. 


## Characters vs factors

Most `data.frame`s in R will have character variables automatically converted
into factors. 

```{r}
str(case0501)
```

Note that `Diet` is a factor. 

```{r}
str(case0501$Diet)
```

Although printing out this variable makes it look like a character:

```{r}
case0501$Diet
```
There is actually an internal representation via integers:

```{r}
as.numeric(case0501$Diet)
```

This representation can be accessed using `levels()`:

```{r}
nlevels(case0501$Diet)
levels(case0501$Diet)
```

The ordering here is alphabetical.

When you run `summary()` or `table()`, 
R uses this ordering for displaying results:

```{r}
summary(case0501$Diet)
table(case0501$Diet)
```

You can convert characters to factors. 

```{r}
this <- as.factor(c("a","a","b","c"))
this
```

You can also convert factors back to characters.

```{r}
as.character(this)
```

When reading data into R, `read.csv()` will automatically convert 
characters into factors while `read_csv()` from the `dplyr` package doesn't. 

#### Activity

Practice reading and writing files using `read.csv()` and `readr::read_csv()`.
Specifically, do the following

1. Write `case0501` to a csv using `write.csv()`. Use the help file to ensure that you do not write the rownames.
1. Read the created csv file in using both `read.csv()` and `readr::read_csv()`. What differences are there?
1. Use the help file for `read.csv()` to read in the data without converting Diet 
to a factor.
1. Convert Diet in the `readr::read_csv()` funtion to a factor. 
1. Write `case0501` to a csv using `readr::write_csv()` and see what the differences are
from the first step.

<div id="readcsv_activity_solution" style="display:none"> 
Here is what I would do
```{r, purl=FALSE, eval=FALSE}
# Write csv file
write.csv(case0501, file = "tmp.csv", row.names = FALSE)

# Read csv file
d  <- read.csv("tmp.csv") 
d2 <- readr::read_csv("tmp.csv") 

# Don't convert to factor when reading in
d  <- read.csv("tmp.csv", stringsAsFactors = FALSE)

# Convert Diet into a factor
d2 <- d2 %>%
  mutate(Diet = factor(Diet))

readr::write_csv(case0501, path = "tmp2.csv") # Automatically doesn't include rownames
```
</div> 
<button title="Show a solution" type="button" onclick="if(document.getElementById('readcsv_activity_solution') .style.display=='none') {document.getElementById('readcsv_activity_solution') .style.display=''}else{document.getElementById('readcsv_activity_solution') .style.display='none'}">Show/Hide Solution</button>



### Creating factors

We have already seen that you can create factors using the `as.factor()` 
function. 
But sometimes we want a bit more control. 
In particular, we may be interested in affecting the ordering of the 
levels of the factor. 

To adjust the ordering of the levels of the factor, 
use the `levels` argument of the `factor()` function.

```{r}
newDiet = factor(case0501$Diet, 
                 levels = c("NP","N/N85","N/R40","N/R50","lopro","R/R50"))
table(newDiet) # compare to table(case0501$Diet)
```

You can also 

## Using categorical variables in a regression

Let's perform the Lifetime-Diet ``regression'' using R.

```{r}
m <- lm(Lifetime ~ Diet, data = case0501)
summary(m)
```

Notice that it automatically constructed all our indicator variables. 
It automatically chose the N/N85 diet as the reference level (because it came
first alphabetically). 

